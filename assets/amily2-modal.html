<style>
    .amily2-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        width: 100%;
    }
    .header-column {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .header-column.center {
        gap: 0px;
    }
    .side-button {
        writing-mode: vertical-rl; /* 【V59.0】恢复垂直模式 */
        text-orientation: mixed;
        height: 140px;
        width: 50px;
        padding: 10px 5px;
        text-align: center;
        line-height: 1.3;
    }
    .side-button > i {
        writing-mode: horizontal-tb;
        display: block;
        margin: 0 auto 10px auto;
        font-size: 1.3em;
    }
    #amily2_open_tutorial, #amily2_update_button_new {
        writing-mode: horizontal-tb !important;
        height: auto !important;
        width: auto !important;
        padding: 5px 10px !important;
        line-height: normal !important;
    }
    #amily2_update_button_new {
        display: none;
        background-color: #4CAF50 !important;
    }
    
    .version-info-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background-color: rgba(255, 255, 255, 0.03);
        border-radius: 5px;
        font-size: 12px;
        line-height: 1.3;
    }
    
    .version-info-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #adb6e6;
    }
    
    .version-label {
        font-size: 10px;
        opacity: 0.7;
        margin-bottom: 2px;
    }
    
    .version-number {
        font-weight: bold;
        font-family: monospace;
    }
    
    .version-current .version-number {
        color: #68b7ff;
    }
    
    .version-latest .version-number {
        color: #4CAF50;
    }
    
    .version-latest.has-update .version-number {
        color: #ff6b6b;
        animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
        from { text-shadow: 0 0 5px rgba(255, 107, 107, 0.5); }
        to { text-shadow: 0 0 10px rgba(255, 107, 107, 0.8), 0 0 15px rgba(255, 107, 107, 0.3); }
    }

    .collapsible-legend {
        cursor: pointer;
        user-select: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
    }
    .collapsible-legend:hover {
        background-color: rgba(255, 255, 255, 0.05);
    }
    .collapse-icon {
        transition: transform 0.2s ease-in-out;
    }
    .collapsible-content {
        padding-top: 10px;
    }
    .disclaimer-box {
        margin-top: 15px;
        padding: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        background-color: rgba(0, 0, 0, 0.1);
    }
    .disclaimer-emo {
        font-style: italic;
        color: #adb6e6;
        text-align: center;
        margin-bottom: 10px;
        font-size: 13px;
    }
    .disclaimer-text {
        font-size: 12px;
        color: #c0c0c0;
        line-height: 1.6;
    }
    .disclaimer-text strong {
        color: #ffc107;
        display: block;
        margin-bottom: 5px;
    }
</style>
<div class="flex-container">
    <div id="amily2_chat_optimiser">

        <div id="auth_panel" style="display: none;">
            <div class="auth-header">
                <div class="auth-title"><i class="fas fa-crown"></i> Amily2号优化助手 - 授权验证</div>
                <div class="auth-subtitle">解锁完整功能 享受智能优化体验</div>
                <div id="expiry_info"></div>
            </div>
            <div class="auth-code-input">
                <input type="password" id="amily2_auth_code" placeholder="输入授权码..."><button id="auth_submit">验证</button>
            </div>
            <div class="auth-daily-code">
                <span>今日授权码:</span>
                <span id="amily2_daily_code_display" class="daily-code">正在生成...</span>
                <button id="amily2_copy_daily_code" class="copy-button" title="复制授权码"><i class="fas fa-copy"></i></button>
            </div>
            <div class="auth-footer">声明:完全免费，禁止商用。仅供娱乐，严禁用于任何违法行为,且任何使用行为与作者无关。</div>
        </div>


<div class="plugin-features" style="display: none;">

<fieldset class="settings-group">
    <legend style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <span><i class="fas fa-cog"></i> Amily中枢</span>

        
        <div style="display: flex; gap: 5px;">
            <button id="amily2_reset_auth" class="menu_button small_button interactable" title="清除授权">
                <i class="fas fa-sign-out-alt"></i>
            </button>
            <button id="amily2_open_tutorial" class="menu_button small_button interactable" title="查看使用教程">
                教程
            </button>
        </div>
        
    </legend>
</fieldset>

<div class="disclaimer-box">
    <p class="disclaimer-emo">“我也想过琴棋书画诗酒花，奈何生活只有柴米油盐酱醋茶。”</p>
    <p class="disclaimer-text">
        <strong>免责声明：</strong>本插件仅供个人学习与技术交流使用，严禁用于任何商业目的或非法活动。使用者需自行承担因使用本插件而产生的一切风险与法律责任，开发者对此不承担任何责任。
    </p>
</div>

<fieldset class="settings-group">
    <legend><i class="fas fa-bullhorn"></i> 作者留言</legend>
    <div id="amily2_message_board" style="display: flex; justify-content: center; align-items: center; padding: 8px; background-color: rgba(255, 255, 255, 0.05); border-radius: 5px; min-height: 40px;">
        <div id="amily2_message_content" style="color: #adb6e6; font-size: 13px; line-height: 1.5; text-align: center;"></div>
    </div>
</fieldset>
<fieldset class="settings-group">
    <legend><i class="fas fa-code-branch"></i> 版本信息</legend>
    <div class="version-info-container">
        <div class="version-info-item version-current">
            <div class="version-label">当前版本</div>
            <div id="amily2_current_version" class="version-number">加载中...</div>
        </div>
        <div class="version-info-item version-center" style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
            <div style="position: relative;">
                <button id="amily2_update_button" class="menu_button small_button interactable" title="查看更新日志">
                    <i class="fas fa-bell"></i>
                </button>
                <div id="amily2_update_indicator" class="update-indicator" style="display: none;"></div>
            </div>
            <button id="amily2_update_button_new" class="menu_button small_button interactable" title="查看更新日志">更新</button>
        </div>
        <div class="version-info-item version-latest">
            <div class="version-label">最新版本</div>
            <div id="amily2_latest_version" class="version-number">检查中...</div>
        </div>
    </div>
</fieldset>

<fieldset class="settings-group">
    <legend><i class="fas fa-plus-circle"></i> 记忆增强</legend>
    <div class="button-group" style="display: flex; justify-content: space-between; gap: 8px;">
        <button id="amily2_open_additional_features" class="menu_button wide_button"><i class="fas fa-landmark-dome"></i> 总结模块</button>
        <button id="amily2_open_rag_palace" class="menu_button wide_button"><i class="fas fa-brain"></i> 向量模块</button>
        <button id="amily2_open_memorisation_forms" class="menu_button wide_button"><i class="fas fa-table"></i> 表格模块</button>
        <button id="amily2_open_character_world_book" class="menu_button wide_button"><i class="fa-solid fa-book-atlas"></i> 角色世界</button>
    </div>
</fieldset>
 
<fieldset class="settings-group">
    <legend><i class="fas fa-puzzle-piece"></i> 附加功能</legend>
    <div class="button-group" style="display: flex; justify-content: space-between; gap: 8px;">
        <button id="amily2_open_plot_optimization" class="menu_button wide_button"><i class="fas fa-feather-alt"></i> 记忆管理</button>
        <button id="amily2_open_text_optimization" class="menu_button wide_button"><i class="fas fa-cogs"></i> 正文优化</button>
        <button id="amily2_open_world_editor" class="menu_button wide_button"><i class="fas fa-globe"></i> 世界编辑</button>
        <button id="amily2_open_glossary" class="menu_button wide_button"><i class="fas fa-book"></i> 术语表单</button>
        <button id="amily2_open_renderer" class="menu_button wide_button"><i class="fas fa-paint-brush"></i> 前端渲染</button>
    </div>
</fieldset>

<fieldset class="settings-group">
    <legend><i class="fas fa-flask"></i> 内测功能</legend>
    <div class="button-group" style="display: flex; justify-content: space-between; gap: 8px;">
        <button id="amily2_open_super_memory" class="menu_button wide_button"><i class="fas fa-brain"></i> 超级记忆</button>
        <button id="amily2_open_auto_char_card" class="menu_button wide_button"><i class="fas fa-robot"></i> 一键生卡</button>
    </div>
</fieldset>

<hr class="header-divider">


			 
			<fieldset class="settings-group collapsible">
                <legend class="collapsible-legend"><i class="fas fa-palette"></i> 界面定制 <i class="fas fa-chevron-down collapse-icon"></i></legend>
                <div class="collapsible-content">
                    <div class="amily2_settings_block">
                        <label>帝国徽记位置:</label>
                        <div class="radio-toggle-group">
                        <input type="radio" id="amily2_icon_location_topbar" name="amily2_icon_location" value="topbar">
                        <label for="amily2_icon_location_topbar">驻扎顶栏</label>
                        <input type="radio" id="amily2_icon_location_extensions" name="amily2_icon_location" value="extensions">
                        <label for="amily2_icon_location_extensions">收归扩展</label>
                    </div>
                    <small class="notes">为解决部分移动端UI溢出问题。更改后将立即生效。</small>
                </div>
                <div class="amily2_settings_block color-controls-container">
                    <div class="color-picker-group">
                        <div class="color-picker-item">
                            <label for="amily2_bg_color">背景色:</label>
                            <input type="color" id="amily2_bg_color" value="#1e1e1e">
                        </div>
                        <div class="color-picker-item">
                            <label for="amily2_button_color">按钮色:</label>
                            <input type="color" id="amily2_button_color" value="#4a4a4a">
                        </div>
                        <div class="color-picker-item">
                            <label for="amily2_text_color">文字颜色:</label>
                            <input type="color" id="amily2_text_color" value="#ffffff">
                        </div>
                    </div>
                    <button id="amily2_restore_colors" class="menu_button small_button">默认</button>
                </div>
                <div class="amily2_settings_block">
                    <label for="amily2_bg_opacity">背景透明度: <span id="amily2_bg_opacity_value">0</span></label>
                    <input type="range" id="amily2_bg_opacity" min="0" max="1" step="0.01" value="0">
                </div>
                <div class="amily2_settings_block">
                    <label>自定义背景图:</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label for="amily2_custom_bg_image" class="menu_button wide_button" style="cursor: pointer; text-align: center; flex-grow: 1;">
                            <i class="fas fa-upload"></i> 上传图片
                        </label>
                        <input type="file" id="amily2_custom_bg_image" accept="image/*" style="display: none;">
                        <button id="amily2_restore_bg_image" class="menu_button small_button">默认</button>
                        <small class="notes">选择一张图片作为背景。推荐使用小于5MB的图片。</small>
                    </div>
                </div>
            </fieldset>
			
                <legend><i class="fas fa-tools"></i> 诊断与操作</legend>
                <div class="amily2_settings_block button-pair">
                    <button class="menu_button primary interactable" id="amily2_test"><i class="fas fa-search"></i> 测试检查</button>
                    <button class="menu_button accent interactable" id="amily2_fix_now"><i class="fas fa-magic"></i> 立即修复</button>
                </div>
            </fieldset>
        </div>

        <div id="amily2_hidden_prompts" style="display:none;">
            <div class="amily2_settings_block">
                <div class="prompt-container">
                    <textarea id="amily2_main_prompt" class="text_pole" rows="6"></textarea>
                    <button id="save_main_prompt" class="menu_button small_button interactable"><i class="fas fa-save"></i> 保存</button>
                </div>
            </div>
            <div class="amily2_settings_block">
                <div class="prompt-container">
                    <textarea id="amily2_system_prompt" class="text_pole" rows="8"></textarea>
                    <button id="save_system_prompt" class="menu_button small_button interactable"><i class="fas fa-save"></i> 保存</button>
                </div>
            </div>
            <div class="amily2_settings_block">
                <div class="prompt-container">
                    <textarea id="amily2_output_format_prompt" class="text_pole" rows="4"></textarea>
                    <button id="save_output_format_prompt" class="menu_button small_button interactable"><i class="fas fa-save"></i> 保存</button>
                </div>
            </div>
        </div>
    </div>
</div>
