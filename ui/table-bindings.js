const _0x438707=_0x1b90;(function(_0xaeeaec,_0x7ee87){const _0x1a6bd4=_0x1b90,_0x47d8f6=_0xaeeaec();while(!![]){try{const _0x94cad5=-parseInt(_0x1a6bd4(0x1aa))/0x1*(-parseInt(_0x1a6bd4(0x1a1))/0x2)+-parseInt(_0x1a6bd4(0x208))/0x3+parseInt(_0x1a6bd4(0x1cb))/0x4+parseInt(_0x1a6bd4(0x354))/0x5+parseInt(_0x1a6bd4(0x1f0))/0x6+-parseInt(_0x1a6bd4(0x277))/0x7+-parseInt(_0x1a6bd4(0x1b0))/0x8*(-parseInt(_0x1a6bd4(0x311))/0x9);if(_0x94cad5===_0x7ee87)break;else _0x47d8f6['push'](_0x47d8f6['shift']());}catch(_0x33cb36){_0x47d8f6['push'](_0x47d8f6['shift']());}}}(_0x5ddf,0x9c49a));import*as _0x415584 from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings,getContext}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{updateOrInsertTableInChat}from'./message-table-renderer.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';import{showHtmlModal}from'./page-window.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';import{world_names,loadWorldInfo}from'/scripts/world-info.js';import{safeCharLorebooks,safeLorebookEntries}from'../core/tavernhelper-compatibility.js';import{characters,this_chid,eventSource,event_types}from'/script.js';function _0x1b90(_0x3526cf,_0x592973){const _0x5ddf3b=_0x5ddf();return _0x1b90=function(_0x1b90bb,_0xc65a6c){_0x1b90bb=_0x1b90bb-0x161;let _0x1015cb=_0x5ddf3b[_0x1b90bb];return _0x1015cb;},_0x1b90(_0x3526cf,_0x592973);}import{fetchNccsModels,testNccsApiConnection}from'../core/api/NccsApi.js';const isTouchDevice=()=>window[_0x438707(0x279)](_0x438707(0x25b))[_0x438707(0x2f8)],getAllTablesContainer=()=>document['getElementById'](_0x438707(0x34f));let isResizing=![];function toggleRowContextMenu(_0x419225){const _0x2a1b9a=_0x438707;_0x419225[_0x2a1b9a(0x16f)](),_0x419225['stopPropagation']();const _0x51e99d=_0x419225[_0x2a1b9a(0x189)]['closest'](_0x2a1b9a(0x211));if(!_0x51e99d)return;const _0x5892b4=_0x51e99d[_0x2a1b9a(0x28b)](_0x2a1b9a(0x22f));if(!_0x5892b4)return;const _0x55be16=_0x51e99d['classList'][_0x2a1b9a(0x27a)](_0x2a1b9a(0x2a9));document[_0x2a1b9a(0x1ab)](_0x2a1b9a(0x168))[_0x2a1b9a(0x1ef)](_0x37b617=>{const _0x128a40=_0x2a1b9a;if(_0x37b617!==_0x51e99d){_0x37b617[_0x128a40(0x240)]['remove'](_0x128a40(0x2a9));const _0x52bc83=_0x37b617[_0x128a40(0x28b)]('.amily2-table-wrapper');_0x52bc83&&(_0x52bc83[_0x128a40(0x324)][_0x128a40(0x1f2)]=_0x128a40(0x32a),_0x52bc83[_0x128a40(0x324)]['zIndex']='',_0x52bc83['style'][_0x128a40(0x198)]='');}}),_0x51e99d[_0x2a1b9a(0x240)]['toggle']('amily2-menu-open');_0x51e99d['classList']['contains'](_0x2a1b9a(0x2a9))?(_0x5892b4[_0x2a1b9a(0x324)][_0x2a1b9a(0x1f2)]='visible',_0x5892b4[_0x2a1b9a(0x324)][_0x2a1b9a(0x198)]=_0x2a1b9a(0x1b2),_0x5892b4[_0x2a1b9a(0x324)][_0x2a1b9a(0x1cf)]='10'):(_0x5892b4['style']['overflowX']='auto',_0x5892b4['style'][_0x2a1b9a(0x198)]='',_0x5892b4['style']['zIndex']='');const _0x51b4fe=_0x13ef87=>{const _0x3bcd75=_0x2a1b9a;!_0x51e99d[_0x3bcd75(0x27a)](_0x13ef87[_0x3bcd75(0x189)])&&(_0x51e99d[_0x3bcd75(0x240)][_0x3bcd75(0x27b)](_0x3bcd75(0x2a9)),_0x5892b4[_0x3bcd75(0x324)][_0x3bcd75(0x1f2)]='auto',_0x5892b4['style'][_0x3bcd75(0x198)]='',_0x5892b4[_0x3bcd75(0x324)][_0x3bcd75(0x1cf)]='',document[_0x3bcd75(0x1bb)]('click',_0x51b4fe,!![]));};_0x51e99d['classList'][_0x2a1b9a(0x27a)](_0x2a1b9a(0x2a9))&&setTimeout(()=>{const _0x1b849d=_0x2a1b9a;document[_0x1b849d(0x2ca)]('click',_0x51b4fe,!![]);},0x0);}function toggleColumnContextMenu(_0x75d4a9){const _0x159efb=_0x438707;if(isResizing||_0x75d4a9[_0x159efb(0x189)][_0x159efb(0x240)][_0x159efb(0x27a)](_0x159efb(0x2b3)))return;_0x75d4a9[_0x159efb(0x16f)](),_0x75d4a9[_0x159efb(0x309)]();const _0x4e54f3=_0x75d4a9[_0x159efb(0x189)][_0x159efb(0x28b)]('th');if(!_0x4e54f3)return;const _0x2ed0d1=_0x4e54f3[_0x159efb(0x28b)]('.amily2-table-wrapper');if(!_0x2ed0d1)return;const _0x3ebee7=_0x4e54f3[_0x159efb(0x240)][_0x159efb(0x27a)](_0x159efb(0x2a9));document[_0x159efb(0x1ab)](_0x159efb(0x1de))[_0x159efb(0x1ef)](_0x2b4669=>{const _0x5cb4a9=_0x159efb;if(_0x2b4669!==_0x4e54f3){_0x2b4669[_0x5cb4a9(0x240)]['remove'](_0x5cb4a9(0x2a9));const _0x354862=_0x2b4669[_0x5cb4a9(0x28b)](_0x5cb4a9(0x22f));_0x354862&&(_0x354862[_0x5cb4a9(0x324)][_0x5cb4a9(0x1f2)]='auto',_0x354862[_0x5cb4a9(0x324)][_0x5cb4a9(0x1cf)]='',_0x354862[_0x5cb4a9(0x324)][_0x5cb4a9(0x198)]='');}}),_0x4e54f3[_0x159efb(0x240)][_0x159efb(0x2a6)](_0x159efb(0x2a9));_0x4e54f3[_0x159efb(0x240)][_0x159efb(0x27a)](_0x159efb(0x2a9))?(_0x2ed0d1[_0x159efb(0x324)][_0x159efb(0x1f2)]=_0x159efb(0x332),_0x2ed0d1[_0x159efb(0x324)][_0x159efb(0x198)]=_0x159efb(0x1b2),_0x2ed0d1[_0x159efb(0x324)]['zIndex']='10'):(_0x2ed0d1[_0x159efb(0x324)][_0x159efb(0x1f2)]=_0x159efb(0x32a),_0x2ed0d1['style'][_0x159efb(0x198)]='',_0x2ed0d1[_0x159efb(0x324)][_0x159efb(0x1cf)]='');const _0x570286=_0x425da6=>{const _0x3a7f9b=_0x159efb;!_0x4e54f3[_0x3a7f9b(0x27a)](_0x425da6[_0x3a7f9b(0x189)])&&(_0x4e54f3['classList'][_0x3a7f9b(0x27b)](_0x3a7f9b(0x2a9)),_0x2ed0d1[_0x3a7f9b(0x324)][_0x3a7f9b(0x1f2)]=_0x3a7f9b(0x32a),_0x2ed0d1['style']['position']='',_0x2ed0d1[_0x3a7f9b(0x324)][_0x3a7f9b(0x1cf)]='',document['removeEventListener'](_0x3a7f9b(0x162),_0x570286,!![]));};_0x4e54f3['classList'][_0x159efb(0x27a)]('amily2-menu-open')&&setTimeout(()=>{const _0x10bf84=_0x159efb;document['addEventListener'](_0x10bf84(0x162),_0x570286,!![]);},0x0);}function _0x5ddf(){const _0x31f532=['reorganizeEventBound','updateTableRules','warning','label','表格系统总开关已关闭，请先启用总开关。','楼层不能小于1。','getElementById','.nccs-button-row','main-api','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22exclusion-rule-item\x22\x20data-index=\x22','context-reading-slider','<i\x20class=\x22fas\x20fa-plus-circle\x22></i>\x20创建第一行','2px','injection','pending-deletion-row','marginBottom','#amily2_memorisation_forms_panel\x20.sinan-navigation-deck','ai-flow-template-editor','.edit-rules-btn','show-table-in-chat-toggle','nccs-api-key','fa-arrow-up','getBatchFillerRuleTemplate','button','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','\x22\x20placeholder=\x22结束标记\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20danger\x20small_button\x20remove-rule-btn\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','#generic-input','context_reading_level','addTable','.amily2-table-wrapper','justifyContent','tableIndex','nccs-api-model','createElement','columnIndex','字数限制为0表示不设置规则。','.amily2-context-menu','true','成功获取\x20','change','未找到可用的SillyTavern配置文件','touches','col-index','amily2-clear-all-tables-btn','colgroup\x20>\x20col:nth-child(','input[name=\x22table_worldbook_source\x22]','classList','请输入有效的起始楼层和结束楼层。','nccs-sillytavern-preset','comment','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22exclusion-rule-item\x22\x20data-index=\x22','</b>:\x20不超过\x20','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','addRow','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','push','move-row-down-btn','.sinan-nav-item','success','insertRow','批量填表-规则提示词已恢复默认。','exportPreset','wb-entry-check-','.radio-group','innerHeight','fill-selected-floors-btn','.exclusion-rule-item','th.index-col','编辑列名','\x20个SillyTavern配置文件','0.5','#exclusion-rules-list','</option>','(pointer:\x20coarse)','已添加第一行','exportPresetFull','filter','select','在下加行','add-right','rollbackAndRefill','table_exclusion_rules','previousElementSibling','删除该行','tagName','请选择一个列。','innerHTML','聊天内表格显示设置及其依赖关系已成功绑定。','table_tags_to_extract','table_independent_rules_enabled','<option\x20value=\x22\x22>--\x20请选择模型\x20--</option>','独立提取规则已保存。','Nccs\x20API连接测试失败，请检查配置','向右移动','#rule-add',']”\x20吗？此操作不可逆！','map','move-table-up-btn','重新整理功能启动失败，请检查系统状态。','none','table_worldbook_enabled','5643743txVcVH','floorEventBound','matchMedia','contains','remove','span','表名：','<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20获取中...','startFloorRangeFilling','”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22\x20style=\x22border:\x201px\x20solid\x20#444;\x20padding:\x2010px;\x20border-radius:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-weight:\x20bold;\x20color:\x20#9e8aff;\x22>内容长度限制\x20(0为禁用)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22current-char-limit-rules\x22\x20style=\x22margin-top:\x2010px;\x20display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','pointer','起始楼层不能大于结束楼层。','您确定要将流程提示词恢复为默认设置吗？','insertCell','.remove-char-limit-rule-btn','../core/table-system/batch-filler.js','filling_mode','amily2-clear-global-preset-btn','character','表格系统总开关','closest','log','table-updated','startCurrentFloorFilling','table_system_enabled','无法找到世界书设置的相关UI元素，绑定失败。','extensionSettings','table_worldbook_source','option','add-left','<i\x20class=\x22fas\x20fa-table\x20table-rename-icon\x22\x20data-table-index=\x22','templateEventsBound','add-table-placeholder','在左加列','.hly-scroll','saveBatchFillerRuleTemplate','parentNode','批量填表-规则提示词已保存。','Nccs\x20API获取到\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-limit-rule-item\x22\x20style=\x22display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20padding:\x208px;\x20background:\x20rgba(0,0,0,0.1);\x20border-radius:\x204px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span><i\x20class=\x22fas\x20fa-file-alt\x22\x20style=\x22margin-right:\x208px;\x20color:\x20#9e8aff;\x22></i><b>','.amily2_opt_settings_block','[内存储司]\x20回退重填功能失败:','.popup-button-cancel','flex','table-system-master-switch','table-controls','block','toggle','fa-arrow-down','恢复该行','amily2-menu-open','move-up','Header\x20#\x20clicked\x20for\x20table','keypress','menu_button\x20small_button','\x22选定楼层填表\x22按钮已成功绑定。','。请切换聊天以应用更改。','.remove-rule-btn','moveTable','rule_delete','amily2-resizer','focus','\x22\x20placeholder=\x22例如:\x20content,game,time\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20class=\x22notes\x22>仅提取指定XML标签的内容，例如填“content”，即提取<content>...</content>中的内容。</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label><b>内容排除规则</b></label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22exclusion-rules-list\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x208px;\x20margin-top:\x208px;\x22>','table_injection_enabled','charLimitRules','10000','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22add-char-limit-rule-area\x22\x20style=\x22margin-top:\x2015px;\x20padding-top:\x2015px;\x20border-top:\x201px\x20solid\x20#333;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<select\x20id=\x22new-rule-column-select\x22\x20class=\x22text_pole\x22\x20style=\x22flex:\x201;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22-1\x22>--\x20选择要添加规则的列\x20--</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','nccsMaxTokens','then','getUpdatedTables','.add-row-btn','checkbox','alignItems','【最终警告】您确定要永久废黜表格\x20“[','../core/table-system/reorganizer.js','nccs-temperature','pending-deletion','bottom','.move-table-up-btn','amily2-menu-active','absolute','table_selected_worldbooks','startsWith','addEventListener','name','请输入新表格的名称：','input[type=\x22checkbox\x22]:checked','deleteTable','table-role-system','selected','val','table','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22add-exclusion-rule-btn\x22\x20class=\x22menu_button\x20small_button\x22\x20style=\x22margin-top:\x2010px;\x22><i\x20class=\x22fas\x20fa-plus\x22></i>\x20添加规则</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20class=\x22notes\x22>移除所有被起始和结束标记包裹的内容（例如\x20OOC\x20部分）。</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','<p\x20class=\x22notes\x22>未选择或绑定世界书。</p>','updateRow','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22padding:\x2010px;\x20border-radius:\x206px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.3);\x20background:\x20rgba(0,0,0,0.2);\x20color:\x20#fff;\x20font-size:\x201em;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22','touch','在右加列','nccsApiMode','nextSibling','textContent','世界书:\x20','showModal','batchEventBound','rowStatuses','querySelector','loadTables','上下文读取级别已设置为\x20','table_worldbook_char_limit','show_table_in_chat','floor-end-input','add-below','limit','在上加行','名称不能为空！','#add-exclusion-rule-btn','render_on_every_message','CHAT_CHANGED','error','close','checked','info','wb-check-','\x20个模型','流程提示词已恢复为默认。','#current-char-limit-rules','danger','createTHead','touchend','matches','depth','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','\x22立即填表\x22按钮已成功绑定。','<option\x20value=\x22','列名：','move-left','<p\x20class=\x22notes\x22\x20style=\x22color:red;\x22>获取角色世界书失败。</p>','\x22回退重填\x22按钮已成功绑定。','fa-pen','add','100%','input[name=\x22table-injection-role\x22]','nccsApiKey','请输入表名...','cell-highlight','table-tags-input','stopPropagation','nccsTavernProfile','delete','https://api.openai.com/v1','nccs-api-model-select','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22padding:\x2020px\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2012px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22color:\x20#ccc;\x20font-weight:\x20bold;\x22>','\x22\x20title=\x22重命名\x22></i>\x20','div','25029MxwpTn','已禁用','.settings-group','<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22','无标题条目','\x22></i>\x20','table-independent-rules-container','getHighlights','配置独立提取规则','find','向左移动','nccsEnabled','deleteColumn','fill-table-now-btn','parse','input[name=\x22filling-mode\x22]','opacity','getBatchFillerFlowTemplate','keydown','style','nccsModel','length','importGlobalPreset','<i\x20class=\x22fas\x20fa-download\x22></i>\x20获取模型','\x22重新整理\x22按钮已成功绑定。','auto','space-between','点击添加第一行','saveBatchFillerFlowTemplate','rollback-and-refill-btn','</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22generic-input\x22\x20class=\x22text_pole\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value=\x22','insertColumn','width','visible','\x22\x20placeholder=\x22起始标记\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>-</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x20rule-end\x22\x20value=\x22','原始填表','.control-block-with-switch','appendChild','nccsTemperature','addColumn','index-col','表名已更新为\x20\x22','向下移动','join','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','请输入一个有效的字数限制（大于等于0）。','touchmove','请输入列名...','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x20rule-start\x22\x20value=\x22\x22\x20placeholder=\x22起始标记\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>-</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x20rule-end\x22\x20value=\x22\x22\x20placeholder=\x22结束标记\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20danger\x20small_button\x20remove-rule-btn\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','min','<p>加载条目中...</p>','您确定要将表格状态回退到上一楼，并使用最新消息重新填表吗？','text_pole','restore-row','40px','htmlFor','additional','warn','charLimitRule','top','type','col','all-tables-container','#sinan-','规则提示词已保存。','reorganize-table-btn','编辑表名','2267650YmASDf','touchstart','above','disabled','#new-rule-limit-input','click','secondary-api','body','Nccs\x20API事件绑定完成','insertBefore','”\x20列吗？','.amily2-menu-open','deleteRow','context-reading-value','.popup-button-ok','bookName','未知列\x20(','offsetWidth','preventDefault','rowLimitRule','mouseup','createTBody','currentEventBound','新表格','<p\x20class=\x22notes\x22>所选世界书中没有条目。</p>','down','ai-rule-template-restore-btn','table-injection-depth','eventsBound','data-rules','表格注入设置已成功绑定。','restore-row-btn','scrollTop','amily2-import-global-preset-btn','blur','ai-flow-template-restore-btn','mousemove','.delete-table-btn','[内存储司]\x20加载世界书条目失败:','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','includes','批量填表-流程提示词已保存。','display','无法找到指令模板编辑器或其按钮，绑定失败。','target','nccsApiUrl','rename','profiles','amily2-export-preset-full-btn','ai-rule-template-editor','加载SillyTavern预设失败：','move-row-up-btn','message','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','回退重填失败，请检查系统状态。','contenteditable','rows','nccs-api-url','Nccs\x20API连接测试出错：','position','Nccs\x20API\x20','nccs-api-config','选择预设','delete-row','floor-start-input','appendTo','input','file_name','311458kgDJLU','#rule-update','getAttribute','nccs-api-mode','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>',']\x20世界书设置已刷新','scrollLeft','已启用','getMemoryState','2TXPsdy','querySelectorAll','updateColumnWidth','title','getBoundingClientRect','Nccs\x20API连接测试成功','544uUblcW','right','relative','children','填表模式已切换为\x20','colIndex','headers','nccs-test-connection','mousedown','fa-undo','dataset','removeEventListener','move-right','table_selected_entries','table-independent-rules-enabled','列名已更新为\x20\x22','规则提示词已恢复为默认。','left','uid','has','add-row-above-btn','columnWidths','#add-char-limit-rule-btn','overflowY','book','优化中填表','clientX','2103148ZgbhKd','\x22\x20title=\x22删除此规则\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','您确定要删除\x20“','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','zIndex','value','delete-row-btn','世界书设置已成功绑定。','#exclusion-rules-list\x20.exclusion-rule-item','manual','max','sillytavern_preset','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','center','start','setAttribute','render-on-every-message-toggle','fa-plus-circle','向上移动','th.amily2-menu-open','ai-rule-template-save-btn','[内存储司]\x20重新整理功能导入失败:','active','流程提示词已保存。','分步填表','#rule-note','nccs-temperature-value','rule_update','rowIndex','amily2-cell-content','className','table-configure-rules-btn','amily2-header-text','\x20字</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20danger\x20small_button\x20remove-char-limit-rule-btn\x22\x20data-col-index=\x22','未获取到可用模型','无法获取SillyTavern配置文件列表','forEach','1344300PmnzbG','\x22\x20style=\x22width:\x20100px;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20class=\x22notes\x22>当表格总行数超过设定值时，将在表格底部显示警告。</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr\x20style=\x22border-color:\x20#444;\x20margin:\x2010px\x200;\x22>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>','overflowX','primary','.amily2-context-menu.amily2-menu-active','table-injection-position','表格视图交互事件已成功绑定。','attr','role','nccs-max-tokens','div[style*=\x22overflowX\x22]','stringify','<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22','nccs-fetch-models','指令模板编辑器已成功绑定。','rollbackEventBound','amily2-export-preset-btn','table-injection-enabled','marginTop','fa-trash-alt','rule_add','html','.table-rename-icon','restoreRow','772590fiRqmD','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x20rule-start\x22\x20value=\x22','.json','.rule-end','checkbox-item','optimized','trim','.add-col-btn','amily2-context-menu','td.index-col'];_0x5ddf=function(){return _0x31f532;};return _0x5ddf();}function toggleHeaderIndexContextMenu(_0x1a82cb){const _0x58b91a=_0x438707;_0x1a82cb['preventDefault'](),_0x1a82cb[_0x58b91a(0x309)]();const _0x499685=_0x1a82cb[_0x58b91a(0x189)][_0x58b91a(0x28b)](_0x58b91a(0x255));if(!_0x499685)return;const _0x41fb42=_0x499685[_0x58b91a(0x2e0)](_0x58b91a(0x236));if(!_0x41fb42)return;const _0x3829eb=_0x41fb42['classList'][_0x58b91a(0x27a)](_0x58b91a(0x2c6));document[_0x58b91a(0x1ab)](_0x58b91a(0x1f4))[_0x58b91a(0x1ef)](_0x544ebe=>{const _0x77f419=_0x58b91a;_0x544ebe[_0x77f419(0x240)][_0x77f419(0x27b)](_0x77f419(0x2c6));});!_0x3829eb&&_0x41fb42[_0x58b91a(0x240)]['add']('amily2-menu-active');const _0x571dc6=_0x5965c8=>{const _0x2e2b65=_0x58b91a;!_0x41fb42[_0x2e2b65(0x27a)](_0x5965c8[_0x2e2b65(0x189)])&&(_0x41fb42[_0x2e2b65(0x240)]['remove'](_0x2e2b65(0x2c6)),document['removeEventListener']('click',_0x571dc6,!![]));};setTimeout(()=>{const _0x480fdf=_0x58b91a;_0x41fb42[_0x480fdf(0x240)][_0x480fdf(0x27a)](_0x480fdf(0x2c6))&&document['addEventListener'](_0x480fdf(0x162),_0x571dc6,!![]);},0x0);}function showInputDialog({title:_0x11ea60,label:_0x2b718c,currentValue:_0x36dea7,placeholder:_0x205e1d,onSave:_0x543178}){const _0x27033b=_0x438707,_0x3c7b63='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20custom-input-dialog\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#e0e0e0;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22\x20style=\x22color:\x20#9e8aff;\x22></i>\x20'+_0x11ea60+_0x27033b(0x30e)+_0x2b718c+_0x27033b(0x32f)+_0x36dea7+_0x27033b(0x2d6)+_0x205e1d+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:\x20#aaa;\x20font-style:\x20italic;\x22>提示：输入内容将用于更新项目。</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20justify-content:\x20flex-end;\x20padding-top:\x2015px;\x20border-top:\x201px\x20solid\x20rgba(255,255,255,0.1);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22background:\x20rgba(120,120,120,0.2);\x20border-color:\x20rgba(120,120,120,0.4);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x20取消\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22\x20style=\x22background:\x20rgba(158,138,255,0.3);\x20border-color:\x20rgba(158,138,255,0.6);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x20确认\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>',_0x43c01f=$(_0x3c7b63)[_0x27033b(0x19e)](_0x27033b(0x164)),_0x5df3cc=_0x43c01f['find'](_0x27033b(0x22c)),_0x735826=()=>{const _0x40d110=_0x27033b;_0x43c01f[0x0][_0x40d110(0x2ee)](),_0x43c01f[_0x40d110(0x27b)]();},_0x4365fd=()=>{const _0x5c7b76=_0x27033b,_0x6162e5=_0x5df3cc[_0x5c7b76(0x2d1)]()['trim']();if(_0x6162e5&&_0x6162e5!==_0x36dea7)_0x543178(_0x6162e5);else{if(!_0x6162e5){toastr[_0x5c7b76(0x214)](_0x5c7b76(0x2e9)),_0x5df3cc[_0x5c7b76(0x2b4)]();return;}}_0x735826();};_0x43c01f[_0x27033b(0x31a)]('.popup-button-ok')['on'](_0x27033b(0x162),_0x4365fd),_0x43c01f['find'](_0x27033b(0x2a1))['on'](_0x27033b(0x162),_0x735826),_0x5df3cc['on'](_0x27033b(0x2ac),_0x27ad2c=>{if(_0x27ad2c['which']===0xd)_0x4365fd();}),_0x5df3cc['on'](_0x27033b(0x323),_0x26b5ee=>{if(_0x26b5ee['which']===0x1b)_0x735826();}),_0x43c01f[0x0][_0x27033b(0x2dd)](),_0x5df3cc[_0x27033b(0x2b4)]()[_0x27033b(0x25f)]();}function showColumnNameEditor(_0x1367f,_0x4092bb,_0x5c042b){const _0x1fe370=_0x438707;showInputDialog({'title':_0x1fe370(0x256),'label':_0x1fe370(0x2fd),'currentValue':_0x5c042b,'placeholder':_0x1fe370(0x340),'onSave':_0x2f65b2=>{const _0x3634b6=_0x1fe370;_0x415584['updateHeader'](_0x1367f,_0x4092bb,_0x2f65b2),renderTables(),toastr[_0x3634b6(0x24c)](_0x3634b6(0x1bf)+_0x2f65b2+'\x22');}});}function showTableNameEditor(_0x3eadd7,_0x3eccbe){const _0x1d1320=_0x438707;showInputDialog({'title':_0x1d1320(0x353),'label':_0x1d1320(0x27d),'currentValue':_0x3eccbe,'placeholder':_0x1d1320(0x306),'onSave':_0x1cc11d=>{const _0x39aa70=_0x1d1320;_0x415584['renameTable'](_0x3eadd7,_0x1cc11d),renderTables(),toastr[_0x39aa70(0x24c)](_0x39aa70(0x33a)+_0x1cc11d+'\x22');}});}function positionContextMenu(_0x260e46,_0x321c9f){const _0x12c70a=_0x438707;_0x260e46[_0x12c70a(0x324)][_0x12c70a(0x198)]=_0x12c70a(0x2c7),_0x260e46['style'][_0x12c70a(0x1cf)]=_0x12c70a(0x2b8),_0x260e46[_0x12c70a(0x324)][_0x12c70a(0x1c1)]='0',_0x260e46[_0x12c70a(0x324)][_0x12c70a(0x1b1)]=_0x12c70a(0x32a),_0x260e46[_0x12c70a(0x324)][_0x12c70a(0x202)]='',_0x260e46[_0x12c70a(0x324)][_0x12c70a(0x221)]='',_0x260e46['style']['maxHeight']='',_0x260e46[_0x12c70a(0x324)][_0x12c70a(0x1c7)]='';const _0xb1b7f3=window[_0x12c70a(0x252)],_0x3cb997=_0x321c9f['getBoundingClientRect'](),_0x23970e=0xc8,_0x2a7f4e=_0x321c9f[_0x12c70a(0x28b)](_0x12c70a(0x299)),_0x57dbda=_0x2a7f4e?_0x2a7f4e[_0x12c70a(0x1ae)]():{'top':0x0,'bottom':_0xb1b7f3},_0x4eb75f=Math[_0x12c70a(0x342)](_0xb1b7f3,_0x57dbda[_0x12c70a(0x2c4)])-_0x3cb997[_0x12c70a(0x2c4)],_0x1679bc=_0x3cb997[_0x12c70a(0x34c)]-Math[_0x12c70a(0x1d5)](0x0,_0x57dbda[_0x12c70a(0x34c)]);_0x4eb75f<_0x23970e&&_0x1679bc>_0x4eb75f?(_0x260e46['style']['top']=_0x12c70a(0x32a),_0x260e46['style'][_0x12c70a(0x2c4)]=_0x12c70a(0x303),_0x260e46['style'][_0x12c70a(0x221)]=_0x12c70a(0x21e)):(_0x260e46[_0x12c70a(0x324)][_0x12c70a(0x34c)]=_0x12c70a(0x303),_0x260e46['style']['bottom']='auto',_0x260e46[_0x12c70a(0x324)][_0x12c70a(0x202)]=_0x12c70a(0x21e));const _0x18653d=0xa0,_0x3c60c4=_0x321c9f[_0x12c70a(0x28b)]('table'),_0x19f49b=_0x3c60c4?_0x3c60c4[_0x12c70a(0x28b)](_0x12c70a(0x1fa)):null;if(_0x19f49b){const _0x3b21e4=_0x19f49b['getBoundingClientRect'](),_0x41d98a=_0x3cb997[_0x12c70a(0x1c1)]-_0x3b21e4[_0x12c70a(0x1c1)];_0x41d98a+_0x18653d>_0x3b21e4[_0x12c70a(0x331)]-0x14&&(_0x260e46[_0x12c70a(0x324)][_0x12c70a(0x1c1)]='auto',_0x260e46['style'][_0x12c70a(0x1b1)]='0');}}export function renderTables(){const _0x1df3d6=_0x438707;let _0x2f16f2=_0x415584['getMemoryState']();!_0x2f16f2&&(log('内存状态为空，从聊天记录加载作为后备。',_0x1df3d6(0x34a)),_0x2f16f2=_0x415584[_0x1df3d6(0x2e1)]());const _0x19d963=getAllTablesContainer();if(!_0x2f16f2||!_0x19d963){console[_0x1df3d6(0x2ed)](_0x1df3d6(0x22a));return;}const _0x1a0927=_0x415584[_0x1df3d6(0x318)](),_0x5053db=_0x415584[_0x1df3d6(0x2bc)](),_0x372e6a=document['createDocumentFragment'](),_0x11bdf2=document['getElementById'](_0x1df3d6(0x297));_0x11bdf2&&_0x11bdf2[_0x1df3d6(0x27b)](),_0x2f16f2[_0x1df3d6(0x1ef)]((_0x47be96,_0x236e8b)=>{const _0x5ee2f8=_0x1df3d6,_0x178d53=document[_0x5ee2f8(0x233)](_0x5ee2f8(0x310));_0x178d53['style'][_0x5ee2f8(0x187)]=_0x5ee2f8(0x2a2),_0x178d53['style'][_0x5ee2f8(0x230)]=_0x5ee2f8(0x32b),_0x178d53[_0x5ee2f8(0x324)][_0x5ee2f8(0x2bf)]=_0x5ee2f8(0x1d8);const _0x1d2401=document[_0x5ee2f8(0x233)]('h3');_0x5053db['has'](_0x236e8b)&&_0x1d2401['classList'][_0x5ee2f8(0x302)](_0x5ee2f8(0x28d));_0x1d2401[_0x5ee2f8(0x268)]=_0x5ee2f8(0x295)+_0x236e8b+_0x5ee2f8(0x30f)+_0x47be96[_0x5ee2f8(0x2cb)];const _0x2982c5=document['createElement'](_0x5ee2f8(0x310));_0x2982c5['className']=_0x5ee2f8(0x2a4);const _0x9d0aed=_0x236e8b>0x0?_0x5ee2f8(0x1fc)+_0x236e8b+'\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>':'',_0x54ff0c=_0x236e8b<_0x2f16f2[_0x5ee2f8(0x326)]-0x1?_0x5ee2f8(0x314)+_0x236e8b+_0x5ee2f8(0x184):'';_0x2982c5['innerHTML']=_0x5ee2f8(0x1ce)+_0x9d0aed+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x54ff0c+_0x5ee2f8(0x192)+_0x236e8b+_0x5ee2f8(0x1d7)+_0x236e8b+'\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x178d53[_0x5ee2f8(0x336)](_0x1d2401),_0x178d53[_0x5ee2f8(0x336)](_0x2982c5),_0x372e6a['appendChild'](_0x178d53);const _0x5f5666=document[_0x5ee2f8(0x233)](_0x5ee2f8(0x310));_0x5f5666['className']='amily2-table-wrapper';const _0xe9054d=document['createElement'](_0x5ee2f8(0x2d2));_0xe9054d['id']='amily2-table-'+_0x236e8b,_0xe9054d[_0x5ee2f8(0x1ba)]['tableIndex']=_0x236e8b;const _0x4a072d=document[_0x5ee2f8(0x233)]('colgroup'),_0x5ec4cc=document[_0x5ee2f8(0x233)](_0x5ee2f8(0x34e));_0x5ec4cc[_0x5ee2f8(0x324)][_0x5ee2f8(0x331)]=_0x5ee2f8(0x347),_0x4a072d[_0x5ee2f8(0x336)](_0x5ec4cc);_0x47be96[_0x5ee2f8(0x1b6)]&&_0x47be96[_0x5ee2f8(0x1b6)]['forEach']((_0x1c2d15,_0x304f70)=>{const _0x5daf8f=_0x5ee2f8,_0x1c82eb=document[_0x5daf8f(0x233)](_0x5daf8f(0x34e)),_0x4c929c=_0x47be96['columnWidths']&&_0x47be96['columnWidths'][_0x304f70]?_0x47be96[_0x5daf8f(0x1c5)][_0x304f70]:0x5a;_0x1c82eb['style'][_0x5daf8f(0x331)]=_0x4c929c+'px',_0x4a072d[_0x5daf8f(0x336)](_0x1c82eb);});_0xe9054d['appendChild'](_0x4a072d);let _0x3f065a=0x0;const _0x4f1763=_0x4a072d[_0x5ee2f8(0x1ab)](_0x5ee2f8(0x34e));_0x4f1763[_0x5ee2f8(0x1ef)](_0xba6bcc=>{const _0x178a88=_0x5ee2f8;_0x3f065a+=parseInt(_0xba6bcc[_0x178a88(0x324)][_0x178a88(0x331)],0xa);}),_0xe9054d[_0x5ee2f8(0x324)]['width']=_0x3f065a+'px';const _0x529330=_0xe9054d[_0x5ee2f8(0x2f6)](),_0x50b42f=_0x529330['insertRow'](),_0x460e6a=document['createElement']('th');_0x460e6a[_0x5ee2f8(0x1e9)]=_0x5ee2f8(0x339),_0x460e6a[_0x5ee2f8(0x2db)]='#',_0x460e6a[_0x5ee2f8(0x324)]['cursor']=_0x5ee2f8(0x281),_0x460e6a[_0x5ee2f8(0x1ad)]=_0x5ee2f8(0x32c);if(!_0x47be96['rows']||_0x47be96[_0x5ee2f8(0x195)][_0x5ee2f8(0x326)]===0x0){const _0x43c837=document[_0x5ee2f8(0x233)](_0x5ee2f8(0x310));_0x43c837[_0x5ee2f8(0x1e9)]='amily2-context-menu\x20amily2-header-menu',_0x43c837[_0x5ee2f8(0x324)][_0x5ee2f8(0x187)]=_0x5ee2f8(0x275);const _0x230e09=document['createElement'](_0x5ee2f8(0x229));_0x230e09[_0x5ee2f8(0x268)]=_0x5ee2f8(0x21d),_0x230e09[_0x5ee2f8(0x1e9)]=_0x5ee2f8(0x2ad),_0x230e09[_0x5ee2f8(0x2ca)]('click',_0x4aaea6=>{const _0x42524e=_0x5ee2f8;_0x4aaea6[_0x42524e(0x309)](),_0x415584['addRow'](_0x236e8b),renderTables();}),_0x43c837[_0x5ee2f8(0x336)](_0x230e09),_0x460e6a[_0x5ee2f8(0x336)](_0x43c837),_0x460e6a[_0x5ee2f8(0x2ca)](_0x5ee2f8(0x162),_0x43baea=>{const _0x36fb11=_0x5ee2f8;_0x43baea[_0x36fb11(0x16f)](),_0x43baea['stopPropagation'](),console[_0x36fb11(0x28c)](_0x36fb11(0x2ab),_0x236e8b),_0x415584[_0x36fb11(0x247)](_0x236e8b),renderTables(),toastr['success'](_0x36fb11(0x25c));});}_0x50b42f[_0x5ee2f8(0x336)](_0x460e6a),_0x47be96[_0x5ee2f8(0x1b6)][_0x5ee2f8(0x1ef)]((_0x265e30,_0x124583)=>{const _0x4d7927=_0x5ee2f8,_0x1f3749=document[_0x4d7927(0x233)]('th');_0x1f3749[_0x4d7927(0x1ba)][_0x4d7927(0x1b5)]=_0x124583,_0x1f3749[_0x4d7927(0x324)]['cursor']='pointer';const _0x218421=document['createElement']('span');_0x218421[_0x4d7927(0x1e9)]=_0x4d7927(0x1eb),_0x218421['textContent']=_0x265e30,_0x1f3749[_0x4d7927(0x336)](_0x218421);const _0x3609dc=document[_0x4d7927(0x233)]('div');_0x3609dc[_0x4d7927(0x1e9)]=_0x4d7927(0x210);const _0xaea31f=[{'label':_0x4d7927(0x31b),'action':'move-left','icon':'fa-arrow-left'},{'label':_0x4d7927(0x26f),'action':'move-right','icon':'fa-arrow-right'},{'label':_0x4d7927(0x298),'action':_0x4d7927(0x294),'icon':_0x4d7927(0x1dc)},{'label':_0x4d7927(0x2d8),'action':'add-right','icon':'fa-plus-circle'},{'label':_0x4d7927(0x256),'action':_0x4d7927(0x18b),'icon':_0x4d7927(0x301)},{'label':'删除该列','action':_0x4d7927(0x30b),'icon':_0x4d7927(0x203),'isDanger':!![]}];_0xaea31f[_0x4d7927(0x1ef)](({label:_0x5b18af,action:_0x499526,icon:_0x4856fa,isDanger:_0x5c75bc})=>{const _0x338baa=_0x4d7927,_0x309027=document['createElement'](_0x338baa(0x229));_0x309027['textContent']=_0x5b18af,_0x309027[_0x338baa(0x1e9)]='menu_button\x20small_button';if(_0x5c75bc)_0x309027[_0x338baa(0x240)][_0x338baa(0x302)](_0x338baa(0x2f5));_0x309027[_0x338baa(0x2ca)](_0x338baa(0x162),_0x302ed1=>{const _0x1583a5=_0x338baa;_0x302ed1[_0x1583a5(0x309)]();switch(_0x499526){case _0x1583a5(0x2fe):_0x415584['moveColumn'](_0x236e8b,_0x124583,'left');break;case _0x1583a5(0x1bc):_0x415584['moveColumn'](_0x236e8b,_0x124583,_0x1583a5(0x1b1));break;case _0x1583a5(0x294):_0x415584[_0x1583a5(0x330)](_0x236e8b,_0x124583,_0x1583a5(0x1c1));break;case _0x1583a5(0x261):_0x415584['insertColumn'](_0x236e8b,_0x124583,_0x1583a5(0x1b1));break;case'rename':showColumnNameEditor(_0x236e8b,_0x124583,_0x265e30);break;case _0x1583a5(0x30b):confirm(_0x1583a5(0x1cd)+_0x265e30+_0x1583a5(0x167))&&_0x415584[_0x1583a5(0x31d)](_0x236e8b,_0x124583);break;}renderTables();}),_0x3609dc[_0x338baa(0x336)](_0x309027);}),_0x1f3749[_0x4d7927(0x336)](_0x3609dc);const _0x104877=document[_0x4d7927(0x233)](_0x4d7927(0x310));_0x104877['className']=_0x4d7927(0x2b3),_0x1f3749['appendChild'](_0x104877);const _0x485105=_0x4202e0=>{const _0x1f6fed=_0x4d7927;_0x4202e0[_0x1f6fed(0x16f)](),_0x4202e0['stopPropagation'](),isResizing=!![];const _0x23c9ff=_0x4202e0[_0x1f6fed(0x189)][_0x1f6fed(0x28b)](_0x1f6fed(0x2d2)),_0x4f8d44=_0x4202e0[_0x1f6fed(0x189)]['parentElement'],_0x593add=_0x23c9ff[_0x1f6fed(0x2e0)](_0x1f6fed(0x23e)+(_0x4f8d44['cellIndex']+0x1)+')'),_0x144f60=_0x4202e0[_0x1f6fed(0x34d)][_0x1f6fed(0x2c9)](_0x1f6fed(0x2d7)),_0x306bc1=_0x144f60?_0x4202e0[_0x1f6fed(0x23b)][0x0]['clientX']:_0x4202e0[_0x1f6fed(0x1ca)],_0x130eef=_0x4f8d44[_0x1f6fed(0x16e)],_0x3e1a23=_0x113fd5=>{const _0x482aa7=_0x1f6fed,_0x128218=_0x144f60?_0x113fd5[_0x482aa7(0x23b)][0x0][_0x482aa7(0x1ca)]:_0x113fd5[_0x482aa7(0x1ca)],_0x505a32=_0x130eef+(_0x128218-_0x306bc1);_0x505a32>0x32&&(_0x593add[_0x482aa7(0x324)][_0x482aa7(0x331)]=_0x505a32+'px');},_0x23bd83=()=>{const _0x1b1fdb=_0x1f6fed;document[_0x1b1fdb(0x1bb)](_0x1b1fdb(0x181),_0x3e1a23),document[_0x1b1fdb(0x1bb)](_0x1b1fdb(0x171),_0x23bd83),document[_0x1b1fdb(0x1bb)](_0x1b1fdb(0x33f),_0x3e1a23),document[_0x1b1fdb(0x1bb)](_0x1b1fdb(0x2f7),_0x23bd83);const _0x4fe1ed=parseInt(_0x593add[_0x1b1fdb(0x324)][_0x1b1fdb(0x331)],0xa);_0x415584[_0x1b1fdb(0x1ac)](_0x236e8b,_0x124583,_0x4fe1ed),setTimeout(()=>{isResizing=![];},0x0);};_0x144f60?(document[_0x1f6fed(0x2ca)]('touchmove',_0x3e1a23,{'passive':![]}),document[_0x1f6fed(0x2ca)](_0x1f6fed(0x2f7),_0x23bd83)):(document[_0x1f6fed(0x2ca)](_0x1f6fed(0x181),_0x3e1a23),document[_0x1f6fed(0x2ca)](_0x1f6fed(0x171),_0x23bd83));};_0x104877[_0x4d7927(0x2ca)](_0x4d7927(0x1b8),_0x485105),_0x104877['addEventListener'](_0x4d7927(0x355),_0x485105,{'passive':![]}),_0x50b42f[_0x4d7927(0x336)](_0x1f3749);});const _0x24fb54=_0xe9054d[_0x5ee2f8(0x172)]();_0x47be96[_0x5ee2f8(0x195)]&&_0x47be96['rows'][_0x5ee2f8(0x326)]>0x0&&_0x47be96['rows'][_0x5ee2f8(0x1ef)]((_0x1018d0,_0x37cf9d)=>{const _0x1dbf7c=_0x5ee2f8,_0x39fcfd=_0x24fb54['insertRow']();_0x39fcfd[_0x1dbf7c(0x1ba)][_0x1dbf7c(0x1e7)]=_0x37cf9d;const _0x1c4450=_0x47be96[_0x1dbf7c(0x2df)]?_0x47be96[_0x1dbf7c(0x2df)][_0x37cf9d]:'normal';_0x1c4450===_0x1dbf7c(0x2c3)&&_0x39fcfd['classList']['add'](_0x1dbf7c(0x220));const _0x469aa4=_0x39fcfd[_0x1dbf7c(0x284)]();_0x469aa4['className']=_0x1dbf7c(0x339);const _0xf0f187=document[_0x1dbf7c(0x233)](_0x1dbf7c(0x27c));_0xf0f187[_0x1dbf7c(0x2db)]=_0x37cf9d+0x1,_0x469aa4['appendChild'](_0xf0f187);const _0xa3ce4=document[_0x1dbf7c(0x233)](_0x1dbf7c(0x310));_0xa3ce4[_0x1dbf7c(0x1e9)]='amily2-context-menu\x20amily2-row-context-menu';let _0x517c82;_0x1c4450===_0x1dbf7c(0x2c3)?_0x517c82=[{'label':_0x1dbf7c(0x2a8),'action':_0x1dbf7c(0x346),'icon':_0x1dbf7c(0x1b9),'isSuccess':!![],'btnClass':_0x1dbf7c(0x17c)}]:_0x517c82=[{'label':_0x1dbf7c(0x1dd),'action':_0x1dbf7c(0x2aa),'icon':_0x1dbf7c(0x227),'btnClass':_0x1dbf7c(0x190)},{'label':_0x1dbf7c(0x33b),'action':'move-down','icon':_0x1dbf7c(0x2a7),'btnClass':_0x1dbf7c(0x24a)},{'label':_0x1dbf7c(0x2e8),'action':'add-above','icon':'fa-plus-circle','btnClass':_0x1dbf7c(0x1c4)},{'label':_0x1dbf7c(0x260),'action':_0x1dbf7c(0x2e6),'icon':_0x1dbf7c(0x1dc),'btnClass':'add-row-below-btn'},{'label':_0x1dbf7c(0x265),'action':_0x1dbf7c(0x19c),'icon':_0x1dbf7c(0x203),'isDanger':!![],'btnClass':_0x1dbf7c(0x1d1)}],_0x517c82[_0x1dbf7c(0x1ef)](({label:_0x1ec66e,action:_0x58fef8,icon:_0x57f2f0,isDanger:_0x1daa2c,isSuccess:_0x4fcdc2})=>{const _0x4c0cad=_0x1dbf7c,_0xd7e646=document[_0x4c0cad(0x233)](_0x4c0cad(0x229));_0xd7e646['innerHTML']='<i\x20class=\x22fas\x20'+_0x57f2f0+_0x4c0cad(0x316)+_0x1ec66e,_0xd7e646[_0x4c0cad(0x1e9)]=_0x4c0cad(0x2ad);if(_0x1daa2c)_0xd7e646[_0x4c0cad(0x240)]['add']('danger');if(_0x4fcdc2)_0xd7e646[_0x4c0cad(0x240)][_0x4c0cad(0x302)](_0x4c0cad(0x24c));_0xd7e646[_0x4c0cad(0x2ca)]('click',_0x4dfd96=>{const _0x482e65=_0x4c0cad;_0x4dfd96['stopPropagation']();switch(_0x58fef8){case _0x482e65(0x2aa):_0x415584['moveRow'](_0x236e8b,_0x37cf9d,'up');break;case'move-down':_0x415584['moveRow'](_0x236e8b,_0x37cf9d,_0x482e65(0x176));break;case'add-above':_0x415584[_0x482e65(0x24d)](_0x236e8b,_0x37cf9d,_0x482e65(0x356));break;case _0x482e65(0x2e6):_0x415584[_0x482e65(0x24d)](_0x236e8b,_0x37cf9d,'below');break;case'delete-row':_0x415584[_0x482e65(0x169)](_0x236e8b,_0x37cf9d);break;case'restore-row':_0x415584[_0x482e65(0x207)](_0x236e8b,_0x37cf9d);break;}if(_0x58fef8===_0x482e65(0x19c)||_0x58fef8===_0x482e65(0x346)){}else renderTables();}),_0xa3ce4['appendChild'](_0xd7e646);}),_0x469aa4[_0x1dbf7c(0x336)](_0xa3ce4),_0x1018d0['forEach']((_0x4b076d,_0x2af152)=>{const _0x5edead=_0x1dbf7c,_0x25de13=_0x39fcfd[_0x5edead(0x284)](),_0x3c4a0e=document[_0x5edead(0x233)](_0x5edead(0x310));_0x3c4a0e['className']=_0x5edead(0x1e8),_0x3c4a0e[_0x5edead(0x2db)]=_0x4b076d,_0x25de13[_0x5edead(0x336)](_0x3c4a0e);_0x1c4450!==_0x5edead(0x2c3)&&!isTouchDevice()&&_0x25de13['setAttribute']('contenteditable','true');_0x25de13[_0x5edead(0x1ba)]['colIndex']=_0x2af152,_0x25de13[_0x5edead(0x1ba)][_0x5edead(0x215)]=_0x47be96[_0x5edead(0x1b6)][_0x2af152]||'';const _0x4fd291=_0x236e8b+'-'+_0x37cf9d+'-'+_0x2af152;_0x1a0927[_0x5edead(0x1c3)](_0x4fd291)&&_0x25de13[_0x5edead(0x240)][_0x5edead(0x302)](_0x5edead(0x307));});}),_0x5f5666[_0x5ee2f8(0x336)](_0xe9054d),_0x372e6a[_0x5ee2f8(0x336)](_0x5f5666);}),_0x19d963[_0x1df3d6(0x268)]='',_0x19d963[_0x1df3d6(0x336)](_0x372e6a),_0x11bdf2&&_0x19d963[_0x1df3d6(0x336)](_0x11bdf2),updateOrInsertTableInChat();}function openTableRuleEditor(){const _0x42ab40=_0x438707,_0x52435f=extension_settings[extensionName],_0x3b7124=_0x52435f[_0x42ab40(0x26a)]||'',_0xb74d2=_0x52435f[_0x42ab40(0x263)]||[],_0x668487=_0xb74d2['map']((_0x2411c2,_0x102539)=>_0x42ab40(0x21b)+_0x102539+_0x42ab40(0x209)+_0x2411c2[_0x42ab40(0x1d9)]+_0x42ab40(0x333)+_0x2411c2['end']+_0x42ab40(0x22b))[_0x42ab40(0x33c)](''),_0x1e9759='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22table-rules-editor\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2020px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22table-tags-input\x22><b>标签提取\x20(半角逗号分隔)</b></label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22table-tags-input\x22\x20class=\x22text_pole\x22\x20value=\x22'+_0x3b7124+_0x42ab40(0x2b5)+_0x668487+_0x42ab40(0x2d3),_0x538aa8=showHtmlModal(_0x42ab40(0x319),_0x1e9759,{'onOk':()=>{const _0x28434b=_0x42ab40,_0x433c69=document['getElementById'](_0x28434b(0x308))[_0x28434b(0x1d0)];updateAndSaveTableSetting(_0x28434b(0x26a),_0x433c69);const _0xefda64=[];document[_0x28434b(0x1ab)](_0x28434b(0x1d3))['forEach'](_0x4fed67=>{const _0x1ae6b2=_0x28434b,_0x59e63a=_0x4fed67[_0x1ae6b2(0x2e0)]('.rule-start')[_0x1ae6b2(0x1d0)][_0x1ae6b2(0x20e)](),_0x5185e8=_0x4fed67['querySelector'](_0x1ae6b2(0x20b))[_0x1ae6b2(0x1d0)][_0x1ae6b2(0x20e)]();_0x59e63a&&_0x5185e8&&_0xefda64['push']({'start':_0x59e63a,'end':_0x5185e8});}),updateAndSaveTableSetting('table_exclusion_rules',_0xefda64),toastr['success'](_0x28434b(0x26d));},'onShow':_0xdbb61e=>{const _0x4c57c7=_0x42ab40,_0x11e732=_0xdbb61e['find'](_0x4c57c7(0x259));_0xdbb61e[_0x4c57c7(0x31a)](_0x4c57c7(0x2ea))['on']('click',()=>{const _0x1bc52e=_0x4c57c7,_0x3c3451=_0x11e732[_0x1bc52e(0x1b3)]()['length'],_0x397ef6=_0x1bc52e(0x244)+_0x3c3451+_0x1bc52e(0x341);_0x11e732['append'](_0x397ef6);}),_0x11e732['on'](_0x4c57c7(0x162),_0x4c57c7(0x2b0),function(){const _0x38c723=_0x4c57c7;$(this)[_0x38c723(0x28b)](_0x38c723(0x254))[_0x38c723(0x27b)]();});}});}function openRuleEditor(_0x454e6a){const _0x1a7ba6=_0x438707,_0x254a10=_0x415584['getMemoryState']();if(!_0x254a10||!_0x254a10[_0x454e6a])return;const _0x3df741=_0x254a10[_0x454e6a];_0x3df741['charLimitRule']&&!_0x3df741[_0x1a7ba6(0x2b7)]&&(_0x3df741[_0x1a7ba6(0x2b7)]={},_0x3df741['charLimitRule']['columnIndex']!==-0x1&&(_0x3df741[_0x1a7ba6(0x2b7)][_0x3df741[_0x1a7ba6(0x34b)][_0x1a7ba6(0x234)]]=_0x3df741[_0x1a7ba6(0x34b)][_0x1a7ba6(0x2e7)]));const _0x3fd830=_0x3df741[_0x1a7ba6(0x2b7)]||{},_0x3fe907=_0x37041a=>{const _0x5c8f75=_0x1a7ba6;return Object['entries'](_0x37041a)['map'](([_0x23851c,_0x151319])=>{const _0x59a0df=_0x1b90,_0xc8289a=_0x3df741[_0x59a0df(0x1b6)][_0x23851c]||_0x59a0df(0x16d)+_0x23851c+')';return _0x59a0df(0x29e)+_0xc8289a+_0x59a0df(0x245)+_0x151319+_0x59a0df(0x1ec)+_0x23851c+_0x59a0df(0x1cc);})[_0x5c8f75(0x33c)]('');},_0x1f00b7=_0x4e6932=>{const _0x2d6ff4=_0x1a7ba6;return _0x3df741[_0x2d6ff4(0x1b6)][_0x2d6ff4(0x272)]((_0xffe055,_0x1371dc)=>{const _0x41cb60=_0x2d6ff4;if(_0x4e6932[_0x1371dc])return'';return _0x41cb60(0x2fc)+_0x1371dc+'\x22>'+_0xffe055+_0x41cb60(0x25a);})['join']('');},_0x5a0963='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“'+_0x3df741[_0x1a7ba6(0x2cb)]+_0x1a7ba6(0x280)+_0x3fe907(_0x3fd830)+_0x1a7ba6(0x2b9)+_0x1f00b7(_0x3fd830)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</select>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20id=\x22new-rule-limit-input\x22\x20class=\x22text_pole\x22\x20min=\x220\x22\x20value=\x220\x22\x20style=\x22width:\x2080px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22add-char-limit-rule-btn\x22\x20class=\x22menu_button\x20menu_button_primary\x20small_button\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus\x22></i>\x20添加\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20class=\x22notes\x22>您可以为多个不同的列添加字符数限制规则。</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22\x20style=\x22border:\x201px\x20solid\x20#444;\x20padding:\x2010px;\x20border-radius:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-row-limit-value\x22\x20style=\x22font-weight:\x20bold;\x20color:\x20#9e8aff;\x22>表格行数限制\x20(0为禁用)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20id=\x22rule-row-limit-value\x22\x20class=\x22text_pole\x22\x20min=\x220\x22\x20value=\x22'+(_0x3df741[_0x1a7ba6(0x170)]||0x0)+_0x1a7ba6(0x1f1)+(_0x3df741['note']||'')+_0x1a7ba6(0x248)+(_0x3df741[_0x1a7ba6(0x204)]||'')+_0x1a7ba6(0x1a5)+(_0x3df741[_0x1a7ba6(0x2b2)]||'')+_0x1a7ba6(0x246)+(_0x3df741[_0x1a7ba6(0x1e6)]||'')+_0x1a7ba6(0x2fa),_0x3336fe=$(_0x5a0963)[_0x1a7ba6(0x19e)]('body'),_0x493df5=()=>{const _0x2c438f=_0x1a7ba6;_0x3336fe[0x0][_0x2c438f(0x2ee)](),_0x3336fe[_0x2c438f(0x27b)]();},_0x47458f=()=>{const _0x32b841=_0x1a7ba6,_0x563eca=JSON[_0x32b841(0x31f)](_0x3336fe['find'](_0x32b841(0x2f4))[_0x32b841(0x1f7)](_0x32b841(0x17a))||'{}');_0x3336fe['find'](_0x32b841(0x2f4))[_0x32b841(0x205)](_0x3fe907(_0x563eca)),_0x3336fe['find']('#new-rule-column-select')['html']('<option\x20value=\x22-1\x22>--\x20选择要添加规则的列\x20--</option>'+_0x1f00b7(_0x563eca));};_0x3336fe[_0x1a7ba6(0x31a)](_0x1a7ba6(0x2f4))[_0x1a7ba6(0x1f7)]('data-rules',JSON['stringify'](_0x3fd830)),_0x3336fe['on'](_0x1a7ba6(0x162),_0x1a7ba6(0x1c6),()=>{const _0x2aa0c0=_0x1a7ba6,_0x587b0b=parseInt(_0x3336fe[_0x2aa0c0(0x31a)]('#new-rule-column-select')[_0x2aa0c0(0x2d1)](),0xa),_0x201678=parseInt(_0x3336fe[_0x2aa0c0(0x31a)](_0x2aa0c0(0x161))[_0x2aa0c0(0x2d1)](),0xa);if(_0x587b0b===-0x1){toastr[_0x2aa0c0(0x214)](_0x2aa0c0(0x267));return;}if(isNaN(_0x201678)||_0x201678<0x0){toastr[_0x2aa0c0(0x214)](_0x2aa0c0(0x33e));return;}const _0x1af36d=JSON[_0x2aa0c0(0x31f)](_0x3336fe['find'](_0x2aa0c0(0x2f4))[_0x2aa0c0(0x1f7)]('data-rules')||'{}');_0x201678>0x0?(_0x1af36d[_0x587b0b]=_0x201678,_0x3336fe[_0x2aa0c0(0x31a)]('#current-char-limit-rules')[_0x2aa0c0(0x1f7)](_0x2aa0c0(0x17a),JSON[_0x2aa0c0(0x1fb)](_0x1af36d)),_0x47458f()):toastr[_0x2aa0c0(0x2f0)](_0x2aa0c0(0x235));}),_0x3336fe['on'](_0x1a7ba6(0x162),_0x1a7ba6(0x285),function(){const _0x155f0d=_0x1a7ba6,_0x43c71b=$(this)['data'](_0x155f0d(0x23c)),_0x4b48a5=JSON[_0x155f0d(0x31f)](_0x3336fe[_0x155f0d(0x31a)]('#current-char-limit-rules')[_0x155f0d(0x1f7)]('data-rules')||'{}');delete _0x4b48a5[_0x43c71b],_0x3336fe[_0x155f0d(0x31a)](_0x155f0d(0x2f4))[_0x155f0d(0x1f7)](_0x155f0d(0x17a),JSON[_0x155f0d(0x1fb)](_0x4b48a5)),_0x47458f();}),_0x3336fe['find'](_0x1a7ba6(0x16b))['on'](_0x1a7ba6(0x162),()=>{const _0xa3c79a=_0x1a7ba6,_0x4c8df8=JSON[_0xa3c79a(0x31f)](_0x3336fe['find'](_0xa3c79a(0x2f4))[_0xa3c79a(0x1f7)](_0xa3c79a(0x17a))||'{}'),_0xed78bc=parseInt(_0x3336fe[_0xa3c79a(0x31a)]('#rule-row-limit-value')[_0xa3c79a(0x2d1)](),0xa),_0xec542e={'note':_0x3336fe[_0xa3c79a(0x31a)](_0xa3c79a(0x1e4))[_0xa3c79a(0x2d1)](),'rule_add':_0x3336fe[_0xa3c79a(0x31a)](_0xa3c79a(0x270))['val'](),'rule_delete':_0x3336fe[_0xa3c79a(0x31a)]('#rule-delete')[_0xa3c79a(0x2d1)](),'rule_update':_0x3336fe[_0xa3c79a(0x31a)](_0xa3c79a(0x1a2))['val'](),'charLimitRules':_0x4c8df8,'rowLimitRule':_0xed78bc};_0x415584[_0xa3c79a(0x213)](_0x454e6a,_0xec542e),_0x493df5();}),_0x3336fe['find'](_0x1a7ba6(0x2a1))['on'](_0x1a7ba6(0x162),_0x493df5),_0x3336fe[0x0][_0x1a7ba6(0x2dd)]();}function bindInjectionSettings(){const _0x818022=_0x438707,_0x51f19e=extension_settings[extensionName],_0x4ea870=document['getElementById'](_0x818022(0x2a3)),_0x3d71c3=document[_0x818022(0x218)](_0x818022(0x201)),_0x52b4c6=document['getElementById'](_0x818022(0x1f5)),_0x245c75=document[_0x818022(0x218)](_0x818022(0x178)),_0x157285=document[_0x818022(0x1ab)](_0x818022(0x304));if(!_0x4ea870||!_0x3d71c3||!_0x52b4c6||!_0x245c75||!_0x157285[_0x818022(0x326)])return;const _0x5e87db=()=>{const _0x27619d=_0x818022,_0xa198de=_0x52b4c6[_0x27619d(0x1d0)],_0xefa32d=_0x4ea870['checked'],_0x1009d4=_0xa198de==='1';_0x3d71c3[_0x27619d(0x357)]=!_0xefa32d,_0x52b4c6['disabled']=!_0xefa32d,_0x245c75['disabled']=!_0xefa32d||!_0x1009d4,_0x157285[_0x27619d(0x1ef)](_0x495246=>_0x495246[_0x27619d(0x357)]=!_0xefa32d||!_0x1009d4);const _0x5cd89c=_0xefa32d?'1':'0.5';_0x3d71c3[_0x27619d(0x324)][_0x27619d(0x321)]=_0x5cd89c;_0x3d71c3[_0x27619d(0x28b)](_0x27619d(0x335))&&(_0x3d71c3[_0x27619d(0x28b)]('.control-block-with-switch')[_0x27619d(0x324)][_0x27619d(0x321)]=_0x5cd89c);_0x52b4c6['style'][_0x27619d(0x321)]=_0x5cd89c;_0x52b4c6['previousElementSibling']&&(_0x52b4c6[_0x27619d(0x264)][_0x27619d(0x324)][_0x27619d(0x321)]=_0x5cd89c);const _0x7c69d1=_0xefa32d&&_0x1009d4?'1':_0x27619d(0x258);_0x245c75[_0x27619d(0x324)][_0x27619d(0x321)]=_0x7c69d1;_0x245c75[_0x27619d(0x264)]&&(_0x245c75[_0x27619d(0x264)]['style'][_0x27619d(0x321)]=_0x7c69d1);const _0x7fdb7c=_0xefa32d&&_0x1009d4?'1':_0x27619d(0x258),_0x3967ff=document['getElementById'](_0x27619d(0x2cf))?.['closest'](_0x27619d(0x251));_0x3967ff&&(_0x3967ff[_0x27619d(0x324)][_0x27619d(0x321)]=_0x7fdb7c,_0x3967ff[_0x27619d(0x264)]&&(_0x3967ff['previousElementSibling']['style'][_0x27619d(0x321)]=_0x7fdb7c));const _0x151ab6=document[_0x27619d(0x1ab)](_0x27619d(0x320));_0x151ab6[_0x27619d(0x1ef)](_0x454284=>{const _0x31cf32=_0x27619d;_0x454284[_0x31cf32(0x357)]=!_0xefa32d;const _0x42822b=_0x454284[_0x31cf32(0x28b)](_0x31cf32(0x215));_0x42822b&&(_0x42822b['style'][_0x31cf32(0x321)]=_0xefa32d?'1':'0.5');});const _0x32f43=document[_0x27619d(0x218)](_0x27619d(0x31e));_0x32f43&&(_0x32f43[_0x27619d(0x357)]=!_0xefa32d,_0x32f43[_0x27619d(0x324)][_0x27619d(0x321)]=_0xefa32d?'1':_0x27619d(0x258));};_0x4ea870['checked']=_0x51f19e[_0x818022(0x28f)]!==![],_0x3d71c3[_0x818022(0x2ef)]=_0x51f19e[_0x818022(0x2b6)],_0x52b4c6[_0x818022(0x1d0)]=_0x51f19e[_0x818022(0x21f)]['position'],_0x245c75[_0x818022(0x1d0)]=_0x51f19e[_0x818022(0x21f)][_0x818022(0x2f9)],_0x157285[_0x818022(0x1ef)](_0xcaf368=>{const _0x11a228=_0x818022;parseInt(_0xcaf368[_0x11a228(0x1d0)],0xa)===_0x51f19e['injection'][_0x11a228(0x1f8)]&&(_0xcaf368[_0x11a228(0x2ef)]=!![]);}),_0x5e87db(),_0x4ea870[_0x818022(0x2ca)](_0x818022(0x239),()=>{const _0x4475ff=_0x818022;_0x51f19e[_0x4475ff(0x28f)]=_0x4ea870['checked'],saveSettingsDebounced(),_0x5e87db();const _0xecda9d=_0x4ea870[_0x4475ff(0x2ef)]?_0x4475ff(0x1a8):_0x4475ff(0x312);toastr[_0x4475ff(0x2f0)](_0x4475ff(0x28a)+_0xecda9d+'。'),log(_0x4475ff(0x28a)+_0xecda9d+'。','info');}),_0x3d71c3[_0x818022(0x2ca)]('change',()=>{const _0x1f53b7=_0x818022;_0x51f19e[_0x1f53b7(0x2b6)]=_0x3d71c3[_0x1f53b7(0x2ef)],saveSettingsDebounced();}),_0x52b4c6[_0x818022(0x2ca)](_0x818022(0x239),()=>{const _0x3c4d1a=_0x818022;_0x51f19e[_0x3c4d1a(0x21f)][_0x3c4d1a(0x198)]=parseInt(_0x52b4c6[_0x3c4d1a(0x1d0)],0xa),saveSettingsDebounced(),_0x5e87db();}),_0x245c75[_0x818022(0x2ca)](_0x818022(0x19f),()=>{const _0x387ed9=_0x818022;_0x51f19e[_0x387ed9(0x21f)][_0x387ed9(0x2f9)]=parseInt(_0x245c75[_0x387ed9(0x1d0)],0xa),saveSettingsDebounced();}),_0x157285['forEach'](_0x1de6cb=>{const _0x534fed=_0x818022;_0x1de6cb[_0x534fed(0x2ca)](_0x534fed(0x239),()=>{const _0x4f7056=_0x534fed;_0x1de6cb[_0x4f7056(0x2ef)]&&(_0x51f19e['injection'][_0x4f7056(0x1f8)]=parseInt(_0x1de6cb[_0x4f7056(0x1d0)],0xa),saveSettingsDebounced());});}),log(_0x818022(0x17b),_0x818022(0x24c));}function updateAndSaveTableSetting(_0xf9a45f,_0x146fd9){!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName][_0xf9a45f]=_0x146fd9,saveSettingsDebounced();}function bindWorldBookSettings(){const _0x1a1d94=_0x438707,_0x3cc3f2=extension_settings[extensionName];if(_0x3cc3f2[_0x1a1d94(0x276)]===undefined)_0x3cc3f2[_0x1a1d94(0x276)]=![];if(_0x3cc3f2[_0x1a1d94(0x2e3)]===undefined)_0x3cc3f2[_0x1a1d94(0x2e3)]=0x7530;if(_0x3cc3f2[_0x1a1d94(0x292)]===undefined)_0x3cc3f2[_0x1a1d94(0x292)]=_0x1a1d94(0x289);if(_0x3cc3f2[_0x1a1d94(0x2c8)]===undefined)_0x3cc3f2[_0x1a1d94(0x2c8)]=[];if(_0x3cc3f2[_0x1a1d94(0x1bd)]===undefined)_0x3cc3f2[_0x1a1d94(0x1bd)]={};const _0x1f0f7f=document[_0x1a1d94(0x218)](_0x1a1d94(0x276)),_0x86fbc0=document[_0x1a1d94(0x218)](_0x1a1d94(0x2e3)),_0x17ed55=document['getElementById']('table_worldbook_char_limit_value'),_0x408f1c=document[_0x1a1d94(0x1ab)](_0x1a1d94(0x23f)),_0x5a94cd=document[_0x1a1d94(0x218)]('table_worldbook_select_wrapper'),_0x13d76e=document[_0x1a1d94(0x218)]('table_refresh_worldbooks'),_0x31ece7=document[_0x1a1d94(0x218)]('table_worldbook_checkbox_list'),_0x3c4b1f=document[_0x1a1d94(0x218)]('table_worldbook_entry_list');if(!_0x1f0f7f||!_0x86fbc0||!_0x17ed55||!_0x408f1c[_0x1a1d94(0x326)]||!_0x5a94cd||!_0x13d76e||!_0x31ece7||!_0x3c4b1f){log(_0x1a1d94(0x290),_0x1a1d94(0x34a));return;}const _0x273444=()=>{const _0x3ef32a=_0x1a1d94,_0x42312a={};_0x3c4b1f['querySelectorAll'](_0x3ef32a(0x2cd))[_0x3ef32a(0x1ef)](_0x346b74=>{const _0x54cd1e=_0x3ef32a,_0x26420a=_0x346b74[_0x54cd1e(0x1ba)]['book'],_0xa1ad2=_0x346b74['dataset'][_0x54cd1e(0x1c2)];!_0x42312a[_0x26420a]&&(_0x42312a[_0x26420a]=[]),_0x42312a[_0x26420a][_0x54cd1e(0x249)](_0xa1ad2);}),_0x3cc3f2['table_selected_entries']=_0x42312a,saveSettingsDebounced();},_0x364a5c=async()=>{const _0x25e7da=_0x1a1d94;_0x3c4b1f[_0x25e7da(0x268)]=_0x25e7da(0x343);const _0x5e6d70=_0x3cc3f2[_0x25e7da(0x292)]||_0x25e7da(0x289);let _0x59c552=[];if(_0x5e6d70===_0x25e7da(0x1d4))_0x59c552=_0x3cc3f2[_0x25e7da(0x2c8)]||[];else{if(this_chid!==undefined&&this_chid>=0x0&&characters[this_chid])try{const _0x297e96=await safeCharLorebooks({'type':'all'});if(_0x297e96['primary'])_0x59c552[_0x25e7da(0x249)](_0x297e96[_0x25e7da(0x1f3)]);if(_0x297e96[_0x25e7da(0x349)]?.['length'])_0x59c552[_0x25e7da(0x249)](..._0x297e96['additional']);}catch(_0x374db0){console[_0x25e7da(0x2ed)]('[内存储司]\x20获取角色世界书失败:',_0x374db0),_0x3c4b1f[_0x25e7da(0x268)]=_0x25e7da(0x2ff);return;}else{_0x3c4b1f[_0x25e7da(0x268)]='<p\x20class=\x22notes\x22>请先加载一个角色。</p>';return;}}if(_0x59c552['length']===0x0){_0x3c4b1f['innerHTML']=_0x25e7da(0x2d4);return;}try{const _0x1b2648=[];for(const _0x44ec50 of _0x59c552){const _0x59a402=await safeLorebookEntries(_0x44ec50);_0x59a402[_0x25e7da(0x1ef)](_0x3408a5=>_0x1b2648[_0x25e7da(0x249)]({..._0x3408a5,'bookName':_0x44ec50}));}_0x3c4b1f['innerHTML']='';if(_0x1b2648[_0x25e7da(0x326)]===0x0){_0x3c4b1f[_0x25e7da(0x268)]=_0x25e7da(0x175);return;}_0x1b2648[_0x25e7da(0x1ef)](_0x161ad1=>{const _0x1a58c7=_0x25e7da,_0x4d3f41=document['createElement'](_0x1a58c7(0x310));_0x4d3f41[_0x1a58c7(0x1e9)]='checkbox-item',_0x4d3f41[_0x1a58c7(0x1ad)]=_0x1a58c7(0x2dc)+_0x161ad1[_0x1a58c7(0x16c)]+'\x0aUID:\x20'+_0x161ad1[_0x1a58c7(0x1c2)];const _0x452583=document[_0x1a58c7(0x233)](_0x1a58c7(0x19f));_0x452583[_0x1a58c7(0x34d)]='checkbox',_0x452583['id']=_0x1a58c7(0x250)+_0x161ad1['bookName']+'-'+_0x161ad1[_0x1a58c7(0x1c2)],_0x452583[_0x1a58c7(0x1ba)][_0x1a58c7(0x1c8)]=_0x161ad1['bookName'],_0x452583[_0x1a58c7(0x1ba)]['uid']=_0x161ad1[_0x1a58c7(0x1c2)];const _0xcd2b4b=_0x3cc3f2[_0x1a58c7(0x1bd)][_0x161ad1[_0x1a58c7(0x16c)]]?.['includes'](String(_0x161ad1[_0x1a58c7(0x1c2)]));_0x452583['checked']=!!_0xcd2b4b;const _0x4585ca=document['createElement'](_0x1a58c7(0x215));_0x4585ca[_0x1a58c7(0x348)]=_0x452583['id'],_0x4585ca['textContent']=_0x161ad1[_0x1a58c7(0x243)]||_0x1a58c7(0x315),_0x4d3f41[_0x1a58c7(0x336)](_0x452583),_0x4d3f41[_0x1a58c7(0x336)](_0x4585ca),_0x3c4b1f[_0x1a58c7(0x336)](_0x4d3f41);});}catch(_0x4fa642){console[_0x25e7da(0x2ed)](_0x25e7da(0x183),_0x4fa642),_0x3c4b1f['innerHTML']='<p\x20class=\x22notes\x22\x20style=\x22color:red;\x22>加载条目失败。</p>';}},_0x4b6794=()=>{const _0x347521=_0x1a1d94,_0x2c436c=world_names[_0x347521(0x272)](_0x43174a=>({'name':_0x43174a['replace'](_0x347521(0x20a),''),'file_name':_0x43174a}));_0x31ece7[_0x347521(0x268)]='',_0x2c436c&&_0x2c436c['length']>0x0?_0x2c436c[_0x347521(0x1ef)](_0x160f17=>{const _0x5e89f7=_0x347521,_0x268341=document[_0x5e89f7(0x233)](_0x5e89f7(0x310));_0x268341['className']=_0x5e89f7(0x20c),_0x268341[_0x5e89f7(0x1ad)]=_0x160f17[_0x5e89f7(0x2cb)];const _0x3e7dbd=document[_0x5e89f7(0x233)](_0x5e89f7(0x19f));_0x3e7dbd[_0x5e89f7(0x34d)]=_0x5e89f7(0x2be),_0x3e7dbd['id']='wb-check-'+_0x160f17[_0x5e89f7(0x1a0)],_0x3e7dbd['value']=_0x160f17[_0x5e89f7(0x1a0)],_0x3e7dbd[_0x5e89f7(0x2ef)]=_0x3cc3f2[_0x5e89f7(0x2c8)]['includes'](_0x160f17['file_name']),_0x3e7dbd[_0x5e89f7(0x2ca)](_0x5e89f7(0x239),()=>{const _0x75c93a=_0x5e89f7;_0x3e7dbd[_0x75c93a(0x2ef)]?!_0x3cc3f2[_0x75c93a(0x2c8)][_0x75c93a(0x185)](_0x160f17[_0x75c93a(0x1a0)])&&_0x3cc3f2[_0x75c93a(0x2c8)][_0x75c93a(0x249)](_0x160f17[_0x75c93a(0x1a0)]):_0x3cc3f2[_0x75c93a(0x2c8)]=_0x3cc3f2[_0x75c93a(0x2c8)][_0x75c93a(0x25e)](_0x5783de=>_0x5783de!==_0x160f17[_0x75c93a(0x1a0)]),saveSettingsDebounced(),_0x364a5c();});const _0x159d20=document[_0x5e89f7(0x233)](_0x5e89f7(0x215));_0x159d20[_0x5e89f7(0x348)]=_0x5e89f7(0x2f1)+_0x160f17['file_name'],_0x159d20[_0x5e89f7(0x2db)]=_0x160f17['name'],_0x268341[_0x5e89f7(0x336)](_0x3e7dbd),_0x268341['appendChild'](_0x159d20),_0x31ece7['appendChild'](_0x268341);}):_0x31ece7[_0x347521(0x268)]='<p\x20class=\x22notes\x22>没有找到世界书。</p>',_0x364a5c();},_0x1108ae=()=>{const _0x4d63c7=_0x1a1d94,_0x47c1ec=_0x3cc3f2[_0x4d63c7(0x292)]===_0x4d63c7(0x1d4);_0x5a94cd[_0x4d63c7(0x324)][_0x4d63c7(0x187)]=_0x47c1ec?_0x4d63c7(0x2a5):'none',_0x364a5c(),_0x47c1ec&&_0x4b6794();};_0x1f0f7f[_0x1a1d94(0x2ef)]=_0x3cc3f2[_0x1a1d94(0x276)],_0x86fbc0[_0x1a1d94(0x1d0)]=_0x3cc3f2[_0x1a1d94(0x2e3)],_0x17ed55[_0x1a1d94(0x2db)]=_0x3cc3f2['table_worldbook_char_limit'],_0x408f1c['forEach'](_0x3c041b=>{const _0x409c0e=_0x1a1d94;_0x3c041b[_0x409c0e(0x2ef)]=_0x3c041b[_0x409c0e(0x1d0)]===_0x3cc3f2['table_worldbook_source'];}),_0x1108ae(),_0x1f0f7f[_0x1a1d94(0x2ca)]('change',()=>{_0x3cc3f2['table_worldbook_enabled']=_0x1f0f7f['checked'],saveSettingsDebounced();}),_0x86fbc0['addEventListener'](_0x1a1d94(0x19f),()=>{const _0x545974=_0x1a1d94;_0x17ed55[_0x545974(0x2db)]=_0x86fbc0['value'];}),_0x86fbc0['addEventListener'](_0x1a1d94(0x239),()=>{const _0xac940a=_0x1a1d94;_0x3cc3f2['table_worldbook_char_limit']=parseInt(_0x86fbc0[_0xac940a(0x1d0)],0xa),saveSettingsDebounced();}),_0x408f1c[_0x1a1d94(0x1ef)](_0xdae416=>{const _0x502e97=_0x1a1d94;_0xdae416['addEventListener'](_0x502e97(0x239),()=>{const _0x3539e1=_0x502e97;_0xdae416[_0x3539e1(0x2ef)]&&(_0x3cc3f2[_0x3539e1(0x292)]=_0xdae416[_0x3539e1(0x1d0)],_0x1108ae(),saveSettingsDebounced());});}),_0x13d76e[_0x1a1d94(0x2ca)]('click',_0x4b6794),_0x3c4b1f['addEventListener'](_0x1a1d94(0x239),_0x576a64=>{const _0x5cad41=_0x1a1d94;_0x576a64[_0x5cad41(0x189)][_0x5cad41(0x34d)]===_0x5cad41(0x2be)&&_0x273444();}),log(_0x1a1d94(0x1d2),'success');}export function bindTableEvents(){const _0x2c904e=_0x438707,_0x60e3d3=document[_0x2c904e(0x218)]('amily2_memorisation_forms_panel');if(!_0x60e3d3||_0x60e3d3[_0x2c904e(0x1ba)][_0x2c904e(0x179)])return;log('开始为表格视图绑定交互事件...',_0x2c904e(0x2f0));const _0x2f400f=_0x60e3d3[_0x2c904e(0x1ab)](_0x2c904e(0x320)),_0x54103e=document['getElementById']('context-reading-slider-container'),_0x2e2485=document[_0x2c904e(0x218)](_0x2c904e(0x21c)),_0x51dc8e=document[_0x2c904e(0x218)](_0x2c904e(0x16a)),_0x188dfd=document[_0x2c904e(0x218)](_0x2c904e(0x317)),_0x496723=document['getElementById'](_0x2c904e(0x1be)),_0x509539=document[_0x2c904e(0x218)](_0x2c904e(0x1ea)),_0x4b0e82=()=>{const _0x2ae97a=_0x2c904e,_0x3868dc=extension_settings[extensionName]?.[_0x2ae97a(0x287)]||_0x2ae97a(0x21a);_0x2f400f[_0x2ae97a(0x1ef)](_0x2e2e19=>{_0x2e2e19['checked']=_0x2e2e19['value']===_0x3868dc;});const _0x5e9a51=_0x3868dc===_0x2ae97a(0x163);_0x54103e&&(_0x54103e[_0x2ae97a(0x324)][_0x2ae97a(0x187)]=_0x5e9a51?_0x2ae97a(0x2a5):_0x2ae97a(0x275)),_0x188dfd&&(_0x188dfd['style'][_0x2ae97a(0x187)]='flex'),_0x496723&&_0x509539&&(_0x509539['style'][_0x2ae97a(0x187)]=_0x496723[_0x2ae97a(0x2ef)]?_0x2ae97a(0x2a5):_0x2ae97a(0x275));};_0x2f400f[_0x2c904e(0x1ef)](_0x2d62a9=>{_0x2d62a9['addEventListener']('change',function(){const _0x1acc30=_0x1b90,_0xab0d91=this[_0x1acc30(0x1d0)];updateAndSaveTableSetting('filling_mode',_0xab0d91);let _0x164540=_0x1acc30(0x334);if(_0xab0d91==='secondary-api')_0x164540=_0x1acc30(0x1e3);if(_0xab0d91===_0x1acc30(0x20d))_0x164540=_0x1acc30(0x1c9);toastr[_0x1acc30(0x2f0)](_0x1acc30(0x1b4)+_0x164540+'。'),_0x4b0e82();});});if(_0x2e2485&&_0x51dc8e){const _0x2f605a=extension_settings[extensionName]?.[_0x2c904e(0x22d)]||0x4;_0x2e2485['value']=_0x2f605a,_0x51dc8e[_0x2c904e(0x2db)]=_0x2f605a,_0x2e2485[_0x2c904e(0x2ca)]('input',function(){const _0x2ab3c6=_0x2c904e;_0x51dc8e[_0x2ab3c6(0x2db)]=this['value'];}),_0x2e2485[_0x2c904e(0x2ca)]('change',function(){const _0x1b6d29=_0x2c904e;updateAndSaveTableSetting(_0x1b6d29(0x22d),parseInt(this['value'],0xa)),toastr[_0x1b6d29(0x2f0)](_0x1b6d29(0x2e2)+this[_0x1b6d29(0x1d0)]+'。');});}_0x496723&&(_0x496723['checked']=extension_settings[extensionName]?.[_0x2c904e(0x26b)]??![],_0x496723[_0x2c904e(0x2ca)](_0x2c904e(0x239),()=>{const _0x21ec65=_0x2c904e;updateAndSaveTableSetting(_0x21ec65(0x26b),_0x496723['checked']),_0x4b0e82();}));_0x4b0e82();_0x509539&&_0x509539['addEventListener'](_0x2c904e(0x162),openTableRuleEditor);const _0x23f786=()=>{renderTables(),bindInjectionSettings(),bindTemplateEditors();};_0x23f786(),bindWorldBookSettings(),bindBatchFillButton(),bindFloorFillButtons(),bindReorganizeButton(),bindNccsApiEvents(),bindChatTableDisplaySetting();const _0x1a0e72=document[_0x2c904e(0x2e0)](_0x2c904e(0x222));_0x1a0e72&&_0x1a0e72['addEventListener'](_0x2c904e(0x162),_0x110f46=>{const _0x583262=_0x2c904e,_0x22e89b=_0x110f46[_0x583262(0x189)][_0x583262(0x28b)](_0x583262(0x24b));if(!_0x22e89b)return;const _0x21e646=_0x22e89b[_0x583262(0x1ba)]['tab'];if(!_0x21e646)return;const _0x5df336=_0x22e89b[_0x583262(0x28b)](_0x583262(0x313));if(!_0x5df336)return;_0x5df336[_0x583262(0x1ab)](_0x583262(0x24b))[_0x583262(0x1ef)](_0x5edd56=>_0x5edd56['classList'][_0x583262(0x27b)]('active')),_0x22e89b[_0x583262(0x240)]['add'](_0x583262(0x1e1)),_0x5df336[_0x583262(0x1ab)]('.sinan-tab-pane')[_0x583262(0x1ef)](_0x1d4b29=>_0x1d4b29[_0x583262(0x240)][_0x583262(0x27b)](_0x583262(0x1e1)));const _0x4d5ef8=_0x5df336['querySelector'](_0x583262(0x350)+_0x21e646+'-tab');_0x4d5ef8&&_0x4d5ef8[_0x583262(0x240)]['add'](_0x583262(0x1e1));});const _0x38caa4=document[_0x2c904e(0x218)](_0x2c904e(0x200)),_0x3f3cf7=document['getElementById'](_0x2c904e(0x18d)),_0x2de374=document[_0x2c904e(0x218)]('amily2-import-preset-btn'),_0x2358ae=document[_0x2c904e(0x218)](_0x2c904e(0x17e)),_0x4916e7=document[_0x2c904e(0x218)](_0x2c904e(0x288));_0x38caa4&&_0x38caa4[_0x2c904e(0x2ca)]('click',()=>_0x415584[_0x2c904e(0x24f)]());_0x3f3cf7&&_0x3f3cf7[_0x2c904e(0x2ca)](_0x2c904e(0x162),()=>_0x415584[_0x2c904e(0x25d)]());_0x2de374&&_0x2de374[_0x2c904e(0x2ca)](_0x2c904e(0x162),()=>_0x415584['importPreset'](_0x23f786));_0x2358ae&&_0x2358ae[_0x2c904e(0x2ca)](_0x2c904e(0x162),()=>{const _0x48ad30=_0x2c904e,_0x51f290=_0x415584['isCurrentTablesEmpty']();_0x415584[_0x48ad30(0x327)](()=>{const _0x437cad=_0x48ad30;_0x51f290&&(_0x415584[_0x437cad(0x2e1)](),_0x23f786());});});_0x4916e7&&_0x4916e7[_0x2c904e(0x2ca)]('click',()=>{const _0x5c4a05=_0x2c904e,_0x281445=_0x415584['isCurrentTablesEmpty']();_0x415584['clearGlobalPreset'](),_0x281445&&(_0x415584[_0x5c4a05(0x2e1)](),_0x23f786());});const _0x4dac79=document[_0x2c904e(0x218)](_0x2c904e(0x23d));_0x4dac79&&_0x4dac79[_0x2c904e(0x2ca)](_0x2c904e(0x162),()=>{const _0x4f9d36=_0x2c904e;confirm(_0x4f9d36(0x33d))&&(_0x415584['clearAllTables'](),_0x23f786());});const _0x443fdd=document['getElementById'](_0x2c904e(0x297));_0x443fdd&&_0x443fdd[_0x2c904e(0x2ca)]('click',()=>{const _0x5c17e8=_0x2c904e,_0x459057=prompt(_0x5c17e8(0x2cc),_0x5c17e8(0x174));_0x459057&&_0x459057[_0x5c17e8(0x20e)]()&&(_0x415584[_0x5c17e8(0x22e)](_0x459057[_0x5c17e8(0x20e)]()),_0x23f786());});const _0x407073=getAllTablesContainer();if(_0x407073){_0x407073['addEventListener'](_0x2c904e(0x162),_0x5eebb4=>{const _0x2d9128=_0x2c904e,_0x47f854=_0x5eebb4[_0x2d9128(0x189)][_0x2d9128(0x28b)]('th');if(_0x47f854&&_0x47f854[_0x2d9128(0x240)][_0x2d9128(0x27a)]('index-col')){toggleHeaderIndexContextMenu(_0x5eebb4);return;}if(_0x47f854&&!_0x47f854['classList'][_0x2d9128(0x27a)](_0x2d9128(0x339))){toggleColumnContextMenu(_0x5eebb4);return;}const _0x2ccaa7=_0x5eebb4[_0x2d9128(0x189)]['closest']('td.index-col');if(_0x2ccaa7){toggleRowContextMenu(_0x5eebb4);return;}const _0x5b19ac=_0x5eebb4['target'][_0x2d9128(0x28b)](_0x2d9128(0x206));if(_0x5b19ac){const _0x5d8a93=parseInt(_0x5b19ac[_0x2d9128(0x1ba)]['tableIndex'],0xa),_0xb178eb=_0x415584[_0x2d9128(0x1a9)](),_0x1c36dd=_0xb178eb[_0x5d8a93]?.[_0x2d9128(0x2cb)]||'';showTableNameEditor(_0x5d8a93,_0x1c36dd);return;}const _0x530a2c=_0x5eebb4[_0x2d9128(0x189)][_0x2d9128(0x28b)]('button');if(!_0x530a2c)return;const _0x485d41=parseInt(_0x530a2c[_0x2d9128(0x1ba)][_0x2d9128(0x231)],0xa);if(_0x530a2c[_0x2d9128(0x2f8)](_0x2d9128(0x2bd)))_0x415584[_0x2d9128(0x247)](_0x485d41),_0x23f786();else{if(_0x530a2c[_0x2d9128(0x2f8)](_0x2d9128(0x20f)))_0x415584[_0x2d9128(0x338)](_0x485d41),_0x23f786();else{if(_0x530a2c[_0x2d9128(0x2f8)](_0x2d9128(0x2c5))||_0x530a2c[_0x2d9128(0x2f8)]('.move-table-down-btn')){const _0x19fdc1=_0x530a2c[_0x2d9128(0x240)][_0x2d9128(0x27a)](_0x2d9128(0x273))?'up':'down';_0x415584[_0x2d9128(0x2b1)](_0x485d41,_0x19fdc1),_0x23f786();}else{if(_0x530a2c[_0x2d9128(0x2f8)](_0x2d9128(0x224)))openRuleEditor(_0x485d41);else{if(_0x530a2c[_0x2d9128(0x2f8)](_0x2d9128(0x182))){const _0x331036=_0x415584['getMemoryState'](),_0x59bd25=_0x331036[_0x485d41]?.[_0x2d9128(0x2cb)]||'未知表格';confirm(_0x2d9128(0x2c0)+_0x59bd25+_0x2d9128(0x271))&&(_0x415584[_0x2d9128(0x2ce)](_0x485d41),_0x23f786());}}}}}});if(isTouchDevice()){let _0x57c870=0x0,_0x33f0db=null;_0x407073[_0x2c904e(0x2ca)]('touchstart',_0x5bffac=>{const _0xe3a1fa=_0x2c904e,_0x9cb2e3=_0x5bffac[_0xe3a1fa(0x189)]['closest']('td');if(!_0x9cb2e3||_0x9cb2e3[_0xe3a1fa(0x1ba)][_0xe3a1fa(0x1b5)]===undefined)return;const _0xf81b73=new Date()['getTime'](),_0x223026=_0xf81b73-_0x57c870;_0x223026<0x12c&&_0x223026>0x0&&_0x33f0db===_0x9cb2e3&&(_0x5bffac['preventDefault'](),_0x9cb2e3[_0xe3a1fa(0x1a3)](_0xe3a1fa(0x194))!==_0xe3a1fa(0x237)&&(_0x9cb2e3[_0xe3a1fa(0x1da)](_0xe3a1fa(0x194),'true'),setTimeout(()=>_0x9cb2e3[_0xe3a1fa(0x2b4)](),0x0))),_0x57c870=_0xf81b73,_0x33f0db=_0x9cb2e3;});}_0x407073[_0x2c904e(0x2ca)]('blur',_0x3daa4f=>{const _0x22f7d7=_0x2c904e,_0x4c4b23=_0x3daa4f[_0x22f7d7(0x189)];if(_0x4c4b23[_0x22f7d7(0x266)]!=='TD'||_0x4c4b23[_0x22f7d7(0x1a3)](_0x22f7d7(0x194))!==_0x22f7d7(0x237))return;isTouchDevice()&&_0x4c4b23[_0x22f7d7(0x1da)](_0x22f7d7(0x194),'false');const _0x4df9e2=_0x4c4b23['closest']('table');if(!_0x4df9e2)return;const _0x146f93=parseInt(_0x4df9e2[_0x22f7d7(0x1ba)]['tableIndex'],0xa),_0x179e1e=parseInt(_0x4c4b23[_0x22f7d7(0x28b)]('tr')[_0x22f7d7(0x1ba)]['rowIndex'],0xa),_0x242dcf=parseInt(_0x4c4b23[_0x22f7d7(0x1ba)][_0x22f7d7(0x1b5)],0xa),_0x5260b9=_0x4c4b23[_0x22f7d7(0x2db)],_0x562a04=_0x4df9e2['closest'](_0x22f7d7(0x22f)),_0x88bff0=_0x562a04?_0x562a04[_0x22f7d7(0x1a7)]:0x0,_0x34bb66=_0x407073[_0x22f7d7(0x17d)];_0x415584['addHighlight'](_0x146f93,_0x179e1e,_0x242dcf);const _0xd9750f={[_0x242dcf]:_0x5260b9};_0x415584[_0x22f7d7(0x2d5)](_0x146f93,_0x179e1e,_0xd9750f),_0x23f786();const _0x209781=document[_0x22f7d7(0x218)]('amily2-table-'+_0x146f93)?.[_0x22f7d7(0x28b)](_0x22f7d7(0x22f));_0x209781&&(_0x209781[_0x22f7d7(0x1a7)]=_0x88bff0),_0x407073[_0x22f7d7(0x17d)]=_0x34bb66;},!![]);}_0x60e3d3[_0x2c904e(0x1ba)][_0x2c904e(0x179)]='true',log(_0x2c904e(0x1f6),_0x2c904e(0x24c)),eventSource['on'](event_types[_0x2c904e(0x2ec)],()=>{const _0x332be7=_0x2c904e;console[_0x332be7(0x28c)]('['+extensionName+']\x20检测到角色/聊天切换，正在刷新表格系统UI和世界书设置...'),_0x23f786(),setTimeout(()=>{const _0x4e900b=_0x332be7,_0xca43ae=extension_settings[extensionName];if(_0xca43ae&&_0xca43ae[_0x4e900b(0x276)])try{bindWorldBookSettings(),console[_0x4e900b(0x28c)]('['+extensionName+_0x4e900b(0x1a6));}catch(_0x4eaa4b){console[_0x4e900b(0x2ed)]('['+extensionName+']\x20刷新世界书设置时出错:',_0x4eaa4b);}},0x64);});}function bindBatchFillButton(){const _0x22abeb=_0x438707,_0x3db50f=document[_0x22abeb(0x218)]('fill-table-now-btn');if(_0x3db50f){if(_0x3db50f[_0x22abeb(0x1ba)][_0x22abeb(0x2de)])return;_0x3db50f[_0x22abeb(0x2ca)]('click',_0x7bdd44=>{const _0x137602=_0x22abeb,_0x5ad5d0=extension_settings[extensionName],_0x37c216=_0x5ad5d0[_0x137602(0x28f)]!==![];if(!_0x37c216){_0x7bdd44[_0x137602(0x16f)](),toastr['warning'](_0x137602(0x216));return;}startBatchFilling();}),_0x3db50f[_0x22abeb(0x1ba)][_0x22abeb(0x2de)]='true',log(_0x22abeb(0x2fb),_0x22abeb(0x24c));}}function bindReorganizeButton(){const _0x23b903=_0x438707,_0x5e42e6=document['getElementById'](_0x23b903(0x352));if(_0x5e42e6){if(_0x5e42e6[_0x23b903(0x1ba)][_0x23b903(0x212)])return;_0x5e42e6[_0x23b903(0x2ca)]('click',async _0x47b769=>{const _0x3bff2a=_0x23b903,_0x2a077d=extension_settings[extensionName],_0x52685c=_0x2a077d[_0x3bff2a(0x28f)]!==![];if(!_0x52685c){_0x47b769[_0x3bff2a(0x16f)](),toastr[_0x3bff2a(0x214)](_0x3bff2a(0x216));return;}try{const {reorganizeTableContent:_0x16a3b3}=await import(_0x3bff2a(0x2c1));await _0x16a3b3();}catch(_0x4047c2){console[_0x3bff2a(0x2ed)](_0x3bff2a(0x1e0),_0x4047c2),toastr[_0x3bff2a(0x2ed)](_0x3bff2a(0x274));}}),_0x5e42e6[_0x23b903(0x1ba)][_0x23b903(0x212)]=_0x23b903(0x237),log(_0x23b903(0x329),_0x23b903(0x24c));}}function bindFloorFillButtons(){const _0x424eeb=_0x438707,_0x4d1743=document[_0x424eeb(0x218)](_0x424eeb(0x253)),_0xb8fc1f=document['getElementById']('fill-current-floor-btn'),_0x35381e=document[_0x424eeb(0x218)](_0x424eeb(0x32e));if(_0x4d1743){if(_0x4d1743['dataset'][_0x424eeb(0x278)])return;_0x4d1743[_0x424eeb(0x2ca)](_0x424eeb(0x162),_0x100b8f=>{const _0x53c787=_0x424eeb,_0x19b46e=extension_settings[extensionName],_0x6e7e57=_0x19b46e[_0x53c787(0x28f)]!==![];if(!_0x6e7e57){_0x100b8f[_0x53c787(0x16f)](),toastr['warning']('表格系统总开关已关闭，请先启用总开关。');return;}const _0x50232a=document[_0x53c787(0x218)](_0x53c787(0x19d)),_0x45d8ad=document['getElementById'](_0x53c787(0x2e5)),_0x18328=parseInt(_0x50232a[_0x53c787(0x1d0)],0xa),_0x3a2f84=parseInt(_0x45d8ad[_0x53c787(0x1d0)],0xa);if(!_0x18328||!_0x3a2f84){toastr[_0x53c787(0x214)](_0x53c787(0x241));return;}if(_0x18328>_0x3a2f84){toastr[_0x53c787(0x214)](_0x53c787(0x282));return;}if(_0x18328<0x1){toastr['warning'](_0x53c787(0x217));return;}import(_0x53c787(0x286))[_0x53c787(0x2bb)](_0x21d69d=>{const _0xa81ec8=_0x53c787;_0x21d69d[_0xa81ec8(0x27f)](_0x18328,_0x3a2f84);});}),_0x4d1743[_0x424eeb(0x1ba)][_0x424eeb(0x278)]=_0x424eeb(0x237),log(_0x424eeb(0x2ae),_0x424eeb(0x24c));}if(_0xb8fc1f){if(_0xb8fc1f[_0x424eeb(0x1ba)][_0x424eeb(0x173)])return;_0xb8fc1f[_0x424eeb(0x2ca)]('click',_0x16f09f=>{const _0x28ae27=_0x424eeb,_0x1a5113=extension_settings[extensionName],_0x25a790=_0x1a5113['table_system_enabled']!==![];if(!_0x25a790){_0x16f09f[_0x28ae27(0x16f)](),toastr[_0x28ae27(0x214)](_0x28ae27(0x216));return;}import(_0x28ae27(0x286))['then'](_0x575fdb=>{const _0x945fc6=_0x28ae27;_0x575fdb[_0x945fc6(0x28e)]();});}),_0xb8fc1f[_0x424eeb(0x1ba)][_0x424eeb(0x173)]=_0x424eeb(0x237),log('\x22填当前楼层\x22按钮已成功绑定。',_0x424eeb(0x24c));}if(_0x35381e){if(_0x35381e[_0x424eeb(0x1ba)][_0x424eeb(0x1ff)])return;_0x35381e[_0x424eeb(0x2ca)]('click',async _0x1d397b=>{const _0x176ce8=_0x424eeb,_0x1a2170=extension_settings[extensionName],_0x334c61=_0x1a2170[_0x176ce8(0x28f)]!==![];if(!_0x334c61){_0x1d397b[_0x176ce8(0x16f)](),toastr['warning']('表格系统总开关已关闭，请先启用总开关。');return;}if(confirm(_0x176ce8(0x344)))try{await _0x415584[_0x176ce8(0x262)]();}catch(_0x125cba){console['error'](_0x176ce8(0x2a0),_0x125cba),toastr[_0x176ce8(0x2ed)](_0x176ce8(0x193));}}),_0x35381e[_0x424eeb(0x1ba)]['rollbackEventBound']=_0x424eeb(0x237),log(_0x424eeb(0x300),_0x424eeb(0x24c));}}function bindTemplateEditors(){const _0x4c6f3a=_0x438707,_0x49fb41=document[_0x4c6f3a(0x218)](_0x4c6f3a(0x18e)),_0x183574=document[_0x4c6f3a(0x218)](_0x4c6f3a(0x1df)),_0x3fe8c3=document[_0x4c6f3a(0x218)](_0x4c6f3a(0x177)),_0x1e7618=document[_0x4c6f3a(0x218)](_0x4c6f3a(0x223)),_0x13786d=document[_0x4c6f3a(0x218)]('ai-flow-template-save-btn'),_0x256897=document[_0x4c6f3a(0x218)](_0x4c6f3a(0x180));if(!_0x49fb41||!_0x1e7618||!_0x183574||!_0x13786d){log(_0x4c6f3a(0x188),_0x4c6f3a(0x34a));return;}if(_0x183574[_0x4c6f3a(0x1ba)][_0x4c6f3a(0x296)])return;_0x49fb41['value']=_0x415584[_0x4c6f3a(0x228)](),_0x1e7618['value']=_0x415584[_0x4c6f3a(0x322)](),_0x183574[_0x4c6f3a(0x2ca)](_0x4c6f3a(0x162),()=>{const _0x480701=_0x4c6f3a;_0x415584[_0x480701(0x29a)](_0x49fb41[_0x480701(0x1d0)]),toastr['success'](_0x480701(0x351)),log(_0x480701(0x29c),_0x480701(0x24c));}),_0x13786d['addEventListener']('click',()=>{const _0x1f05cf=_0x4c6f3a;_0x415584[_0x1f05cf(0x32d)](_0x1e7618[_0x1f05cf(0x1d0)]),toastr['success'](_0x1f05cf(0x1e2)),log(_0x1f05cf(0x186),_0x1f05cf(0x24c));}),_0x3fe8c3[_0x4c6f3a(0x2ca)](_0x4c6f3a(0x162),()=>{const _0x14fe2b=_0x4c6f3a;confirm('您确定要将规则提示词恢复为默认设置吗？')&&(_0x49fb41[_0x14fe2b(0x1d0)]=DEFAULT_AI_RULE_TEMPLATE,_0x415584[_0x14fe2b(0x29a)](_0x49fb41['value']),toastr['info'](_0x14fe2b(0x1c0)),log(_0x14fe2b(0x24e),_0x14fe2b(0x2f0)));}),_0x256897['addEventListener'](_0x4c6f3a(0x162),()=>{const _0x4f2cb9=_0x4c6f3a;confirm(_0x4f2cb9(0x283))&&(_0x1e7618[_0x4f2cb9(0x1d0)]=DEFAULT_AI_FLOW_TEMPLATE,_0x415584[_0x4f2cb9(0x32d)](_0x1e7618[_0x4f2cb9(0x1d0)]),toastr['info'](_0x4f2cb9(0x2f3)),log('批量填表-流程提示词已恢复默认。',_0x4f2cb9(0x2f0)));}),_0x183574[_0x4c6f3a(0x1ba)][_0x4c6f3a(0x296)]='true',_0x13786d[_0x4c6f3a(0x1ba)]['templateEventsBound']=_0x4c6f3a(0x237),log(_0x4c6f3a(0x1fe),_0x4c6f3a(0x24c));}function bindNccsApiEvents(){const _0x5f24d0=_0x438707,_0x34f54c=extension_settings[extensionName];if(_0x34f54c[_0x5f24d0(0x31c)]===undefined)_0x34f54c[_0x5f24d0(0x31c)]=![];if(_0x34f54c[_0x5f24d0(0x2d9)]===undefined)_0x34f54c[_0x5f24d0(0x2d9)]='openai_test';if(_0x34f54c['nccsApiUrl']===undefined)_0x34f54c['nccsApiUrl']=_0x5f24d0(0x30c);if(_0x34f54c[_0x5f24d0(0x305)]===undefined)_0x34f54c[_0x5f24d0(0x305)]='';if(_0x34f54c[_0x5f24d0(0x325)]===undefined)_0x34f54c['nccsModel']='';if(_0x34f54c[_0x5f24d0(0x2ba)]===undefined)_0x34f54c[_0x5f24d0(0x2ba)]=0x7d0;if(_0x34f54c[_0x5f24d0(0x337)]===undefined)_0x34f54c[_0x5f24d0(0x337)]=0.7;if(_0x34f54c[_0x5f24d0(0x30a)]===undefined)_0x34f54c['nccsTavernProfile']='';const _0x285c0e=document['getElementById']('nccs-api-enabled'),_0x31ef1c=document[_0x5f24d0(0x218)](_0x5f24d0(0x19a)),_0x10228d=document[_0x5f24d0(0x218)](_0x5f24d0(0x1a4)),_0x2bc57d=document[_0x5f24d0(0x218)](_0x5f24d0(0x196)),_0x37b305=document[_0x5f24d0(0x218)](_0x5f24d0(0x226)),_0x17f190=document[_0x5f24d0(0x218)](_0x5f24d0(0x232)),_0x2bab56=document[_0x5f24d0(0x218)](_0x5f24d0(0x1f9)),_0x4cb6af=document[_0x5f24d0(0x218)]('nccs-max-tokens-value'),_0x4909a1=document[_0x5f24d0(0x218)](_0x5f24d0(0x2c2)),_0x39915e=document['getElementById'](_0x5f24d0(0x1e5)),_0x163790=document[_0x5f24d0(0x218)](_0x5f24d0(0x242)),_0x24111d=document['getElementById'](_0x5f24d0(0x1b7)),_0x3c9eed=document[_0x5f24d0(0x218)](_0x5f24d0(0x1fd));if(!_0x285c0e||!_0x31ef1c)return;_0x285c0e[_0x5f24d0(0x2ef)]=_0x34f54c[_0x5f24d0(0x31c)];if(_0x10228d)_0x10228d[_0x5f24d0(0x1d0)]=_0x34f54c[_0x5f24d0(0x2d9)];if(_0x2bc57d)_0x2bc57d[_0x5f24d0(0x1d0)]=_0x34f54c['nccsApiUrl'];if(_0x37b305)_0x37b305[_0x5f24d0(0x1d0)]=_0x34f54c[_0x5f24d0(0x305)];if(_0x17f190)_0x17f190[_0x5f24d0(0x1d0)]=_0x34f54c[_0x5f24d0(0x325)];if(_0x2bab56){_0x2bab56[_0x5f24d0(0x1d0)]=_0x34f54c[_0x5f24d0(0x2ba)];if(_0x4cb6af)_0x4cb6af[_0x5f24d0(0x2db)]=_0x34f54c[_0x5f24d0(0x2ba)];}if(_0x4909a1){_0x4909a1['value']=_0x34f54c['nccsTemperature'];if(_0x39915e)_0x39915e[_0x5f24d0(0x2db)]=_0x34f54c['nccsTemperature'];}if(_0x163790)_0x163790[_0x5f24d0(0x1d0)]=_0x34f54c[_0x5f24d0(0x30a)]||'';const _0x343064=()=>{const _0x51ea50=_0x5f24d0;_0x31ef1c[_0x51ea50(0x324)][_0x51ea50(0x187)]=_0x285c0e[_0x51ea50(0x2ef)]?'block':_0x51ea50(0x275);};_0x343064();const _0x4a70f6=()=>{const _0x326434=_0x5f24d0;if(!_0x10228d)return;const _0xc1fb70=_0x10228d[_0x326434(0x1d0)]==='sillytavern_preset',_0x3d9d8a=_0x10228d[_0x326434(0x1d0)]==='openai_test',_0xb2bd97=_0x163790?.['closest'](_0x326434(0x29f));_0xb2bd97&&(_0xb2bd97[_0x326434(0x324)][_0x326434(0x187)]=_0xc1fb70?_0x326434(0x2a5):'none');const _0x5a7cc2=[{'element':_0x2bc57d,'containerId':null},{'element':_0x37b305,'containerId':null},{'element':_0x17f190,'containerId':null},{'element':_0x2bab56,'containerId':null},{'element':_0x4909a1,'containerId':null}];_0x5a7cc2['forEach'](({element:_0x47a3bc})=>{const _0x118987=_0x326434;if(_0x47a3bc){const _0x2b0a34=_0x47a3bc[_0x118987(0x28b)](_0x118987(0x29f));_0x2b0a34&&(_0x2b0a34['style']['display']=_0xc1fb70?_0x118987(0x275):'block');}});const _0x42f142=_0x24111d?.[_0x326434(0x28b)](_0x326434(0x219));_0x42f142&&(_0x42f142['style']['display']=_0x326434(0x2a2));};_0x4a70f6(),_0x285c0e[_0x5f24d0(0x2ca)](_0x5f24d0(0x239),()=>{const _0x26c863=_0x5f24d0;_0x34f54c[_0x26c863(0x31c)]=_0x285c0e['checked'],saveSettingsDebounced(),_0x343064(),log(_0x26c863(0x199)+(_0x285c0e[_0x26c863(0x2ef)]?_0x26c863(0x1a8):'已禁用'),_0x26c863(0x2f0));});_0x10228d&&_0x10228d[_0x5f24d0(0x2ca)](_0x5f24d0(0x239),()=>{const _0x51bfe4=_0x5f24d0;_0x34f54c[_0x51bfe4(0x2d9)]=_0x10228d[_0x51bfe4(0x1d0)],saveSettingsDebounced(),_0x4a70f6(),log('Nccs\x20API模式已切换为:\x20'+_0x10228d[_0x51bfe4(0x1d0)],'info');});if(_0x2bc57d){const _0x50b767=()=>{const _0x1f1d46=_0x5f24d0;_0x34f54c[_0x1f1d46(0x18a)]=_0x2bc57d[_0x1f1d46(0x1d0)],saveSettingsDebounced();};_0x2bc57d['addEventListener'](_0x5f24d0(0x17f),_0x50b767);}if(_0x37b305){const _0x277883=()=>{const _0x5d7629=_0x5f24d0;_0x34f54c[_0x5d7629(0x305)]=_0x37b305['value'],saveSettingsDebounced();};_0x37b305['addEventListener'](_0x5f24d0(0x17f),_0x277883);}if(_0x17f190){const _0x4465a3=()=>{const _0x174768=_0x5f24d0;_0x34f54c['nccsModel']=_0x17f190[_0x174768(0x1d0)],saveSettingsDebounced();};_0x17f190[_0x5f24d0(0x2ca)](_0x5f24d0(0x17f),_0x4465a3),_0x17f190[_0x5f24d0(0x2ca)]('input',_0x4465a3);}_0x2bab56&&_0x4cb6af&&(_0x2bab56[_0x5f24d0(0x2ca)](_0x5f24d0(0x19f),()=>{const _0x5b84d6=_0x5f24d0;_0x4cb6af[_0x5b84d6(0x2db)]=_0x2bab56[_0x5b84d6(0x1d0)];}),_0x2bab56[_0x5f24d0(0x2ca)](_0x5f24d0(0x239),()=>{const _0x26430a=_0x5f24d0;_0x34f54c[_0x26430a(0x2ba)]=parseInt(_0x2bab56[_0x26430a(0x1d0)]),saveSettingsDebounced();}));_0x4909a1&&_0x39915e&&(_0x4909a1['addEventListener']('input',()=>{const _0x4fe51d=_0x5f24d0;_0x39915e['textContent']=_0x4909a1[_0x4fe51d(0x1d0)];}),_0x4909a1['addEventListener']('change',()=>{const _0x4ee8f5=_0x5f24d0;_0x34f54c[_0x4ee8f5(0x337)]=parseFloat(_0x4909a1[_0x4ee8f5(0x1d0)]),saveSettingsDebounced();}));_0x163790&&_0x163790[_0x5f24d0(0x2ca)](_0x5f24d0(0x239),()=>{const _0x212725=_0x5f24d0;_0x34f54c[_0x212725(0x30a)]=_0x163790['value'],saveSettingsDebounced();});_0x24111d&&_0x24111d[_0x5f24d0(0x2ca)](_0x5f24d0(0x162),async()=>{const _0x6ee875=_0x5f24d0;_0x24111d[_0x6ee875(0x357)]=!![],_0x24111d['innerHTML']='<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20测试中...';try{const _0x444ceb=await testNccsApiConnection();_0x444ceb?(toastr[_0x6ee875(0x24c)]('Nccs\x20API连接测试成功！'),log(_0x6ee875(0x1af),'success')):(toastr[_0x6ee875(0x2ed)](_0x6ee875(0x26e)),log('Nccs\x20API连接测试失败',_0x6ee875(0x2ed)));}catch(_0x1ed5c1){toastr[_0x6ee875(0x2ed)]('Nccs\x20API连接测试出错：'+_0x1ed5c1['message']),log(_0x6ee875(0x197)+_0x1ed5c1['message'],'error');}finally{_0x24111d['disabled']=![],_0x24111d['innerHTML']='<i\x20class=\x22fas\x20fa-plug\x22></i>\x20测试连接';}});_0x3c9eed&&_0x3c9eed['addEventListener']('click',async()=>{const _0x21d6f9=_0x5f24d0;_0x3c9eed[_0x21d6f9(0x357)]=!![],_0x3c9eed[_0x21d6f9(0x268)]=_0x21d6f9(0x27e);_0x2bc57d&&(_0x34f54c[_0x21d6f9(0x18a)]=_0x2bc57d[_0x21d6f9(0x1d0)]);_0x37b305&&(_0x34f54c['nccsApiKey']=_0x37b305['value']);saveSettingsDebounced();try{const _0x42d5ab=await fetchNccsModels();if(_0x42d5ab&&_0x42d5ab['length']>0x0){let _0x209fea=document[_0x21d6f9(0x218)](_0x21d6f9(0x30d));!_0x209fea&&(_0x209fea=document[_0x21d6f9(0x233)](_0x21d6f9(0x25f)),_0x209fea['id']=_0x21d6f9(0x30d),_0x209fea[_0x21d6f9(0x1e9)]=_0x21d6f9(0x345),_0x17f190[_0x21d6f9(0x29b)][_0x21d6f9(0x166)](_0x209fea,_0x17f190[_0x21d6f9(0x2da)])),_0x209fea[_0x21d6f9(0x268)]=_0x21d6f9(0x26c),_0x42d5ab[_0x21d6f9(0x1ef)](_0x10164d=>{const _0xf97b8c=_0x21d6f9,_0x41b620=document['createElement'](_0xf97b8c(0x293));_0x41b620[_0xf97b8c(0x1d0)]=_0x10164d['id']||_0x10164d[_0xf97b8c(0x2cb)],_0x41b620[_0xf97b8c(0x2db)]=_0x10164d[_0xf97b8c(0x2cb)]||_0x10164d['id'],(_0x10164d['id']||_0x10164d[_0xf97b8c(0x2cb)])===_0x34f54c['nccsModel']&&(_0x41b620[_0xf97b8c(0x2d0)]=!![]),_0x209fea[_0xf97b8c(0x336)](_0x41b620);}),_0x17f190[_0x21d6f9(0x324)][_0x21d6f9(0x187)]=_0x21d6f9(0x275),_0x209fea[_0x21d6f9(0x324)][_0x21d6f9(0x187)]=_0x21d6f9(0x2a5),_0x209fea[_0x21d6f9(0x2ca)](_0x21d6f9(0x239),()=>{const _0x4f2a81=_0x21d6f9,_0x35c907=_0x209fea[_0x4f2a81(0x1d0)];_0x34f54c[_0x4f2a81(0x325)]=_0x35c907,_0x17f190[_0x4f2a81(0x1d0)]=_0x35c907,saveSettingsDebounced();}),toastr['success'](_0x21d6f9(0x238)+_0x42d5ab['length']+_0x21d6f9(0x2f2)),log(_0x21d6f9(0x29d)+_0x42d5ab[_0x21d6f9(0x326)]+_0x21d6f9(0x2f2),_0x21d6f9(0x24c));}else toastr['warning'](_0x21d6f9(0x1ed)),log('Nccs\x20API未获取到可用模型','warn');}catch(_0x3031cc){toastr['error']('获取模型失败：'+_0x3031cc[_0x21d6f9(0x191)]),log('Nccs\x20API获取模型失败：'+_0x3031cc['message'],'error');}finally{_0x3c9eed[_0x21d6f9(0x357)]=![],_0x3c9eed[_0x21d6f9(0x268)]=_0x21d6f9(0x328);}});const _0x2c1bdb=async()=>{const _0x620f3a=_0x5f24d0;if(!_0x163790)return;try{const _0x527441=getContext();if(!_0x527441?.['extensionSettings']?.['connectionManager']?.[_0x620f3a(0x18c)])throw new Error(_0x620f3a(0x1ee));const _0x1a5153=_0x527441[_0x620f3a(0x291)]['connectionManager'][_0x620f3a(0x18c)],_0x3886c6=_0x34f54c['nccsTavernProfile'];_0x163790['innerHTML']='',_0x163790[_0x620f3a(0x336)](new Option(_0x620f3a(0x19b),'',![],![])),_0x1a5153&&_0x1a5153[_0x620f3a(0x326)]>0x0?(_0x1a5153['forEach'](_0x3261f6=>{const _0x1a40fc=_0x620f3a,_0x534f21=_0x3261f6['id']===_0x3886c6,_0x2b384a=new Option(_0x3261f6[_0x1a40fc(0x2cb)],_0x3261f6['id'],_0x534f21,_0x534f21);_0x163790[_0x1a40fc(0x336)](_0x2b384a);}),log('成功加载\x20'+_0x1a5153[_0x620f3a(0x326)]+_0x620f3a(0x257),'success')):log(_0x620f3a(0x23a),_0x620f3a(0x34a));}catch(_0x526242){log(_0x620f3a(0x18f)+_0x526242[_0x620f3a(0x191)],_0x620f3a(0x2ed));}};_0x10228d&&_0x163790&&(_0x10228d['addEventListener'](_0x5f24d0(0x239),()=>{const _0x29c62c=_0x5f24d0;_0x10228d[_0x29c62c(0x1d0)]===_0x29c62c(0x1d6)&&_0x2c1bdb();}),_0x34f54c['nccsApiMode']===_0x5f24d0(0x1d6)&&_0x2c1bdb()),log(_0x5f24d0(0x165),_0x5f24d0(0x24c));}function bindChatTableDisplaySetting(){const _0x3ec522=_0x438707,_0x4e59fa=extension_settings[extensionName],_0x17ac6a=document[_0x3ec522(0x218)](_0x3ec522(0x225)),_0x17de71=document[_0x3ec522(0x218)](_0x3ec522(0x1db));if(!_0x17ac6a||!_0x17de71){log('找不到聊天内表格相关的开关，绑定失败。',_0x3ec522(0x34a));return;}_0x17ac6a[_0x3ec522(0x2ef)]=_0x4e59fa['show_table_in_chat']===!![],_0x17de71[_0x3ec522(0x2ef)]=_0x4e59fa[_0x3ec522(0x2eb)]===!![];const _0x326933=()=>{const _0x6158e5=_0x3ec522;_0x17ac6a[_0x6158e5(0x2ef)]?(_0x17de71[_0x6158e5(0x357)]=![],_0x17de71[_0x6158e5(0x28b)]('.control-block-with-switch')[_0x6158e5(0x324)]['opacity']='1'):(_0x17de71[_0x6158e5(0x357)]=!![],_0x17de71[_0x6158e5(0x28b)](_0x6158e5(0x335))['style'][_0x6158e5(0x321)]=_0x6158e5(0x258));};_0x326933(),_0x17ac6a[_0x3ec522(0x2ca)](_0x3ec522(0x239),()=>{const _0x1829c1=_0x3ec522;_0x4e59fa[_0x1829c1(0x2e4)]=_0x17ac6a[_0x1829c1(0x2ef)],saveSettingsDebounced(),toastr[_0x1829c1(0x2f0)]('聊天内表格显示已'+(_0x17ac6a[_0x1829c1(0x2ef)]?'开启':'关闭')+'。'),_0x326933();}),_0x17de71[_0x3ec522(0x2ca)]('change',()=>{const _0x143d1f=_0x3ec522;_0x4e59fa[_0x143d1f(0x2eb)]=_0x17de71[_0x143d1f(0x2ef)],saveSettingsDebounced(),toastr[_0x143d1f(0x2f0)]('持续渲染最新消息功能已'+(_0x17de71[_0x143d1f(0x2ef)]?'开启':'关闭')+_0x143d1f(0x2af));}),log(_0x3ec522(0x269),_0x3ec522(0x24c));}
